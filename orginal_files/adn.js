"use strict";var adn=adn||{};adn.calls=adn.calls||[];try{!function(C,P,T){var c="ADN_DEV_SCRIPT",n=!!(P.getElementById(c)||{}).src;if(C.out&&!n)return C.out.devOutput("adn.out is already defined","initial check");var w,e,I,p,E,i,D={env:{localhost:{id:"localhost",as:"localhost:8078"},coreuidist:{id:"coreuidist",as:"core-ui-dist:8078"},dev:{id:"dev",as:"adserver.dev.adnuntius.com",dt:"dev.data.adnuntius.com"},staging:{id:"staging",as:"adserver.staging.adnuntius.com",dt:"staging.data.adnuntius.com"},production:{id:"production",as:"delivery.adnuntius.com",dt:"data.adnuntius.com"}},dn:{as:"delivery.",dt:"data."},sync:{PLATFORM_161:"https://ads.creative-serving.com/cm?redir=https%3A%2F%2Fdata.adnuntius.com%2Fsync%3FbrowserId%3D{BROWSER_ID}%26folderId%3D{FOLDER_ID}%26externalSystemType%3DP161%26externalSystemUserId%3D%24%7BUUID%7D"},events:{CUSTOM:"CUSTOM"},methodEnums:{ifr:"ifr",composed:"composed",preview:"preview",previewDirect:"previewDirect"},loadEnums:{lazy:"lazy",lazyRequest:"lazyRequest"},requestMode:{hasTarget:"hasTarget",default:"default"},requestTiming:{immediate:"immediate",onReady:"onReady",onLoad:"onLoad"},syncAds:["//pagead2.googlesyndication.com/pagead/show_ads.js"],postMessageType:{toParentImpression:"toParentImpression",toParentPageLoad:"toParentPageLoad",toParentResize:"toParentResize",toParentUpdateAd:"toParentUpdateAd",toParentSubscribe:"toParentSubscribe",toParentGetAdUnitInfo:"toParentGetAdUnitInfo",toParentFunctions:"toParentFunctions",toParentAllChildrenViewed:"toParentAllChildrenViewed",toParentAdVisibilityEvent:"toParentAdVisibilityEvent",toParentCustomEvent:"toParentCustomEvent",toParentIsolateAdVisibilityEvent:"toParentIsolateAdVisibilityEvent",toChildViewability:"toChildViewability",toChildPubs:"toChildPubs",toChildAdUnitInfo:"toChildAdUnitInfo"},composedRequest:{noRequest:"noRequest",requestMade:"requestMade",requestReturned:"requestReturned"},container:{iframe:"iframe",div:"div"},feedback:{console:{all:"all",warnings:"warnings",errors:"errors",silent:"silent"},inScreen:{inAdUnit:"inAdUnit",silent:"silent"}},cwClass:"contentWrapperPerItem",widgetIdPrefix:"adn-widget-",adIdPrefix:"adn-id-",longestTime:9e5,defaultProximity:200,defaultVisibilityPercentage:1,postMessageSrcKey:"messageSrc",postMessageSrcValue:"adn",functionContext:{parent:"parent",inIframe:"inIframe"},viewabilityStatus:{notViewed:"notViewed",divMissing:"divMissing",blocked:"blocked",viewed:"viewed",viewSent:"viewSent"},visibilityStatus:{notVisible:"notVisible",visible:"visible",visibleSent:"visibleSent"},displayStatus:{notDisplayed:"notDisplayed",displayed:"displayed"},adStatus:{init:"init",processed:"processed",procured:"procured",distributed:"distributed"},scriptOverride:{github:{id:"github",url:"https://adnuntius.github.io/examples/adn/adn.dev.src.js"},localhost:{id:"localhost",url:"http://localhost:8001/adn.src.js"}},errorStatus:{noTarget:"noTarget"},previewId:"appPreviewId"},S=0,s=0,h=!0,y=!0,O={},A={},x={},k={},M={},L={},d=!1,g="allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox",m="data-parent-top",v="data-env",b="data-dn",l="data-adn-console",N="adn-data-div-",a="adn.metaData",t="adn.data",r="adn.data.segments",o="adn.consent",u={PROFILE:"PROFILE",COUNTS:"COUNTS",EXTERNAL:"EXTERNAL",TARGETING:"TARGETING"},f=["auId","widgetId","auW","auH","w","h","stack","ifrStyle","targetStyle","retAdsW","retAdsH","ads","dims","retAdCount","targetId","replacements","keywords","kv","userSegments","c","ps","auml","floorPrice","requestArgs","targetClass"],R=[],U={console:D.feedback.console.warnings,inScreen:D.feedback.inScreen.silent},q=D.composedRequest.noRequest;C.util={dimension:function(e){if(C.util.isString(e)){var t=C.util.trim(e);return 0===t.length||C.util.endsWith(t,"%")||C.util.endsWith(t,"px")?t:t+"px"}return C.util.isNumber(e)?e+"px":e},isLoopable:function(e){if(C.util.isArray(e))return!0;var t=Object.prototype.toString.call(e);return"[object HTMLCollection]"===t||"[object NodeList]"===t},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"object"==typeof e&&null!==e&&!C.util.isArray(e)},isInteger:function(e){return parseInt(e,10)===e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isString:function(e){return"string"==typeof e},isDefined:function(e){return null!=e},isNotBlankString:function(e){return C.util.isStringWithChars(e)},isStringWithChars:function(e){return C.util.isString(e)&&0<C.util.trim(e).length},isBlankString:function(e){return C.util.isString(e)&&0===C.util.trim(e).length},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},noop:function(){},uniques:function(e){for(var t=[],i=0,n=e.length;i<n;i++)-1===t.indexOf(e[i])&&""!==e[i]&&t.push(e[i]);return t},isTopWindow:function(){return T.top===T.self||"localhost:9876"===T.location.host},trim:function(e){return C.util.isString(e)?String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},getFrameElement:function(){try{return T.frameElement}catch(e){C.out.devOutput("Error looking up frame element")}},endsWith:function(e,t){return C.util.isStringWithChars(e)&&C.util.isStringWithChars(t)&&e.substr(e.length-t.length,t.length)===t},createDelegate:function(e,t){if(!C.util.isObject(e)&&null!==e||!C.util.isFunction(t))return C.out.output("Args not sufficient","createDelegate",e,t);var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,0<i.length?Array.prototype.slice.call(arguments,0).concat(i):arguments)}},detachEventListener:function(e,t,i){return C.util.isObject(e)&&t?C.util.isFunction(e.removeEventListener)?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):C.out.output("Object to attach event listeners is not sufficient","detachEventListener",e,t):C.out.output("Args not sufficient","detachEventListener",e,t)},addEventListener:function(e,t,i){return C.util.isObject(e)&&t?C.util.isFunction(e.addEventListener)?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):C.out.output("Object to attach event listeners is not sufficient","addEventListener",e,t,i):C.out.output("Args not sufficient","addEventListener",e,t,i)},getWindowDims:function(){var e=C.util.getWindowSize();return{w:e.width,h:e.height}},getWindowSize:function(){var e={width:0,height:0};return C.util.isNumber(T.innerWidth)?(e.width=T.innerWidth,e.height=T.innerHeight):P.documentElement&&(P.documentElement.clientWidth||P.documentElement.clientHeight)?(e.width=P.documentElement.clientWidth,e.height=P.documentElement.clientHeight):P.body&&(P.body.clientWidth||P.body.clientHeight)&&(e.width=P.body.clientWidth,e.height=P.body.clientHeight),e},getScrollPos:function(){var e={left:0,top:0};return C.util.isNumber(T.pageYOffset)?(e.top=T.pageYOffset,e.left=T.pageXOffset):P.body&&(P.body.scrollLeft||P.body.scrollTop)?(e.top=P.body.scrollTop,e.left=P.body.scrollLeft):P.documentElement&&(P.documentElement.scrollLeft||P.documentElement.scrollTop)&&(e.top=P.documentElement.scrollTop,e.left=P.documentElement.scrollLeft),e},getElementPosition:function(e){var t={left:0,top:0};if(e.offsetParent)for(;t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;);return t},getNewAjax:function(e,t,i){if(C.util.isDefined(T.XDomainRequest)&&-1===T.navigator.appVersion.indexOf("MSIE 10")){var n=new T.XDomainRequest;return n.open(e,t),n.contentType="text/plain",n.onerror=C.util.noop,n.ontimeout=C.util.noop,n.onprogress=C.util.noop,n.timeout=C.util.noop,n.onload=C.util.noop,C.util.isFunction(i)&&(n.onload=i),n}var r=new XMLHttpRequest;return r.open(e,t),r.setRequestHeader("Content-Type","text/plain"),C.util.isFunction(i)&&(r.onreadystatechange=i),r},hasValue:function(e,t){var i=!1;return C.util.forEach(e,function(e){if(e===t)return!(i=!0)}),i},find:function(i,n){if(!C.util.isFunction(n)||!C.util.isObject(i)&&!C.util.isLoopable(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","find",i,n);var r=null;return C.util.forEach(i,function(e,t){if(!0===n.call(i,e,t))return r=e,!1}),r},map:function(i,n){if(!C.util.isFunction(n)||C.util.isString(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","map",i,n);var r=[];return C.util.forEach(i,function(e,t){r.push(n.call(i,e,t))}),r},filter:function(i,n){if(!C.util.isFunction(n)||C.util.isString(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","filter",i,n);var r=[];return C.util.forEach(i,function(e,t){!0===n.call(i,e,t)&&r.push(e)}),r},forEach:function(e,t){if(!C.util.isFunction(t)||!C.util.isObject(e)&&!C.util.isLoopable(e)||!C.util.isDefined(e))return C.out.output("Args not sufficient","forEach",e,t);var i;if(C.util.isLoopable(e)){for(var n=e.length,r=[],s=0;s<n;s++)r.push(e[s]);for(s=0;s<n;s++)if(i=r[s],!1===t.call(r,i,s))return i}else for(var a in e)if(e.hasOwnProperty(a)&&(i=e[a],!1===t.call(e,i,a)))return i},loadScriptElements:function(e,s){var t=e.getElementsByTagName("script");C.util.forEach(t,function(e){if(e)if(C.util.isStringWithChars(e.type)&&"text/javascript"!==e.type)C.out.devOutput("Not executing script type","showAdContent",e.type,e);else{var t={};C.util.forEach(e.attributes,function(e){e.specified&&(t[e.name]=e.value)});var i=e.innerHTML,n=e.parentNode;if(e.src){var r=e.src;n.removeChild(e),E.loadScriptSrc(r,n.id||s,t,i)}else n.removeChild(e),E.loadScriptContent(i,n.id||s,t)}})},hasProperties:function(e){if(!C.util.isObject(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},getElementDimensions:function(e){try{var t=e.getBoundingClientRect();return{w:t.width||t.right-t.left,h:t.height||t.top-t.bottom}}catch(e){return C.out.output("element dimensions failed","getElementDimensions: catch block",e)}},isTrue:function(e){return!0===e||"true"===e}},function(){C.out={simple:function(e,t){T.console.log("%cAdnuntius%c "+e,"background-color: purple; color: white; padding: 2px; border-radius: 3px;","background-color: white; color: black; padding: 0",t)},devOutput:function(e,t){return!(!d&&U.console!==D.feedback.console.all)&&C.out.output("(dev) "+e,t,Array.prototype.slice.call(arguments,2))},output:function(e,t){if(U.console!==D.feedback.console.silent){var i=Array.prototype.slice.call(arguments,2),n=C.util.filter(i,function(e){return C.util.isFunction(e)}),r=C.util.filter(i,function(e){return!C.util.isFunction(e)}),s=function(e,t,i){e(t,i),C.util.forEach(n,function(e){e({context:t,message:i,args:r})})},a=function(i){r&&r.length&&C.util.forEach(r,function(e,t){C.util.isFunction(e)?n.push(e):i("Arg #"+t,e)})};return T.console&&T.console.warn&&T.console.error&&T.console.log?(C.util.isObject(e)&&0<=e.lineNumber?s(T.console.error,"At "+t+":",e):s(T.console.warn,"At "+t+":",e),a(T.console.log),!1):!1}},warn:function(e){U.console!==D.feedback.console.all&&U.console!==D.feedback.console.warnings||T.console&&T.console.warn&&T.console.warn(e)}};function f(e,t){var i,n,r=e.env||D.env.production.id;i=D.env[r]?D.env[r]:D.env.production;var s=!!e.dn&&D.dn[t||"as"]+e.dn,a="http"+(E.isTestAddress(T.location.href)||r===D.env.localhost.id||"http:"===T.location.protocol?"":"s");n=("https"===e.protocol||"http"===e.protocol?e.protocol:a)+"://";var o=E.isTestAddress(r),u=(d=o||d)&&0===(r||"").indexOf("http")?r:n+(s||i[t||"as"]);return{serverUrlBase:u,baseRequestLoc:u+(o?"?":"/i?")+"tzo="+(new Date).getTimezoneOffset(),isTestEnv:o}}C.lib={setDevMode:function(e){d=!0===e},testingHook:function(e){0===T.location.origin.indexOf("http://localhost")&&(O={},k={},x={},e.adn=C,e.CONSTANTS=D,e.ev=B,e.dom=J,e.readings=G,e.misc=E,e.gComposedAds=k,e.gWidgetSpecs=O,e.gAdSpecs=x,e.gAdLocs=A,e.gDevMode=d,e.gKeywords=R,e.storageMetadataKey=a,e.cookies=H,e.parentMethods=K,e.pFrameMethods=z,e.requestMethods=w)},isParentTopWindow:function(){var e=C.inIframe.getIframeArgs()[m];if(C.util.isTrue(e))return!0;var t=P.getElementsByTagName("body")[0];if(t&&t.hasAttribute(m))return C.util.isTrue(t.getAttribute(m));var i=C.util.getFrameElement();return!!C.util.isDefined(i)&&C.util.isTrue(i.getAttribute(m))},getEnv:function(){var e=C.inIframe.getIframeArgs()[v];if(C.util.isStringWithChars(e)&&D.env[e])return D.env[e].id;var t=P.getElementsByTagName("body")[0];if(e=t?t.getAttribute(v):"",C.util.isStringWithChars(e)&&D.env[e])return D.env[e].id;var i=E.getEnvFromHref(E.getParam(T.location,"host"));return i?i.id:D.env.production.id},getDn:function(){var e=C.inIframe.getIframeArgs()[b];if(C.util.isStringWithChars(e))return e;var t=P.getElementsByTagName("body")[0];return e=t?t.getAttribute(b):"",C.util.isStringWithChars(e)?e:void 0},getAdnDataLocs:function(e){var t=E.clone(e||{});t.protocol="https";var i=f(t,"dt"),n={};return E.copyArgValues(n,t,["browserId","folderId","sessionId"]),!0!==t.noCookies&&!1!==t.useCookies&&!1!==y||(n.noCookies=!0),{page:i.baseRequestLoc.replace("/i?","/page?")+E.encodeAsUrlParams(n,!0),visitor:i.baseRequestLoc.replace("/i?","/visitor?")+E.encodeAsUrlParams(n,!0),user:i.baseRequestLoc.replace("/i?","/usr?")+E.encodeAsUrlParams(n,!0),sync:i.baseRequestLoc.replace("/i?","/sync?")+E.encodeAsUrlParams(n,!0),segment:i.baseRequestLoc.replace("/i?","/segment?")+E.encodeAsUrlParams(n,!0),id:i.baseRequestLoc.replace("/i?","/uui?")+E.encodeAsUrlParams(n,!0)}},getRequestLocs:function(e,t){var i=f(e),n={};E.copyArgValues(n,e,["usi","siteId","latitude","longitude","segments","uui"]);var r=!1;e.adUnits&&C.util.isArray(e.adUnits)&&(r=!!C.util.find(e.adUnits,function(e){return!1===e.useCookies})),!r&&!0!==e.noCookies&&!1!==e.useCookies&&!1!==y||(n.noCookies=!0),!t||C.util.isTopWindow()||E.supportsIntersectionObserver()||(n.immeasurable=!0);var s={},a=E.getQueryParamsByName("adn-lp-li");if(C.util.isStringWithChars(a)){s.lpl=a;var o=E.getQueryParamsByName("adn-lp-c");C.util.isStringWithChars(o)&&(s.lpc=o)}if(a&&C.util.isTopWindow()){var u=P.createElement("div");u.id="previewDiv",u.style.cssText="position:absolute;z-index:1000;background-color:pink;padding:10px;cursor: pointer",u.innerHTML="<div onclick=\"document.getElementById('previewDiv').style.display='none';\">You are previewing ads delivered by Adnuntius. Previewed ads should have a message like this one in their top-left corner.</div>",P.body.prepend(u),I=a,p=o}if(T.URLSearchParams){var d=new URLSearchParams(T.location.search);if(C.util.isTrue(d.get("adn-params")))for(var l,c=d.keys();(l=c.next())&&!l.done;){var g=d.get(l.value);"adn-params"!==l.value&&C.util.isDefined(g)&&(s[l.value]=g)}}return{imp:i.baseRequestLoc+E.encodeAsUrlParams(n,!0)+(C.util.hasProperties(s)?E.encodeAsUrlParams(s,!0):""),rendered:i.baseRequestLoc.replace("/i?","/b?"),viewable:i.baseRequestLoc.replace("/i?","/v?"),visible:i.baseRequestLoc.replace("/i?","/s?"),custom:i.baseRequestLoc.replace("/i?","/u?"),retargeting:i.baseRequestLoc.replace("/i?","/r?"),conversion:i.baseRequestLoc.replace("/i?","/conv?"),preview:i.serverUrlBase+(i.isTestEnv?"?":"/preview?")}},sendRenderedImps:function(e,t){if(!C.util.isArray(e))return C.out.devOutput("No tokens to speak of","sendRenderedImps",e,t);if(!(e.length<1)){if(!t||C.util.isBlankString(t))return C.out.devOutput("Missing a location","sendRenderedImps",e,t);var i=t;s!==S&&0<S&&(i+="&tripTime="+(s=S));var n=C.util.getNewAjax("POST",i,function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&C.util.isStringWithChars(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block send event",t)}e&&e.metaData&&H.writeAdvLs(e.metaData)}}),r={rts:e};E.setAndReturnMetaData(r),n.send(JSON.stringify(r))}},doDebug:function(n,e,t){if(I&&C.util.find(n.ads,function(e){return e.lineItemId===I&&(!p||e.creativeId===p)})){var i=P.createElement("div");i.style.cssText="position:absolute;background-color:pink;padding:5px;z-index:10000;opacity:0.9;cursor:pointer";var r="preview-"+n.widgetId;return i.id=r,i.innerHTML="<div onclick=\"document.getElementById('"+r+"').style.display='none';\">Previewed Ad</>",e.parentNode.insertBefore(i,e),void(t.style.position="relative")}if(U.inScreen===D.feedback.inScreen.inAdUnit){var s=P.createElement("div");s.id=N+n.widgetId;var a="position: absolute;top: 0; left: 0; text-align: left;";a+="border: 1px solid red; background-color: pink; padding: 5px;z-index: 10000;opacity: 0.9;",a+="min-width: 250px;max-width: "+Math.max(e.width,350)+"px; max-height: 500px; overflow: auto",s.style.cssText=a,s.className="adnDebugDataDiv";var o=[];C.util.forEach(n.ads,function(e){o.push({adId:e.id,lineItemId:e.lineItemId,creativeId:e.creativeId,cost:e.cost?e.cost.amount+e.cost.currency:"n/a",bid:e.bid?e.bid.amount+e.bid.currency:"n/a"})});var u="<div style='min-height: 1em;height:auto;'>AU Tag id: <a target='_blank' href='https://admin.adnuntius.com/search?q="+n.auId+"'>"+n.auId+"</a></strong></div>";u+="<div style='padding-bottom: 2px; margin-bottom: 2px; border-bottom: 1px dashed #333;height:auto'><small>",C.util.forEach(n.requestArgs,function(e,t){if("adUnits"!==t)"userId"!==t&&"sessionId"!==t&&(u+=E.dataOutput(t,e));else{var i=C.util.find(e,function(e){return!(e.auId!==n.auId||e.targetId&&e.targetId!==n.targetId||e.targetClass&&e.targetClass!==n.targetClass)});i&&C.util.forEach(i,function(e,t){"auId"!==t&&(u+=E.dataOutput(t,e))})}});var d=H.getIdsAsObj(n);d.userId&&(u+=E.dataOutput("userId",d.userId)),d.sessionId&&(u+=E.dataOutput("sessionId",d.sessionId)),u+="</small></div>",0===o.length&&(u+="<div><strong>No ads returned for ad call</strong></div>"),C.util.forEach(o,function(e){u+="<div style='min-height: 1em;height: auto;'>LI: <a target='_blank' href='http://admin.adnuntius.com/line-items/line-item/"+e.lineItemId+"'>"+e.lineItemId+"</a> | Cr: <a target='_blank' href='http://admin.adnuntius.com/creatives/creative/"+e.creativeId+"'>"+e.creativeId+"</a> | cost: "+e.cost+" | bid: "+e.bid+"</div>"}),u+="<div style='height:auto;'><small>",C.util.forEach(["Segments","Keywords"],function(e){var t="returned"+e;n[t]&&0<n[t].length&&(u+=E.dataOutput(e.toLowerCase(),n[t]))}),u+="</small></div>",s.innerHTML=u,e.parentNode.insertBefore(s,e),t.style.border="2px solid red",t.style.position="relative"}},showAdContent:function(t,e){var i=E.getDocEl(t),n=k[t.targetId];if(!i)return n&&(n.errorStatus=D.errorStatus.noTarget),C.out.output("Unable to find HTML element","showAdContent",n,t),C.out.warn("Unable to find HTML element on page with the following id: "+t.targetId);n&&(n.errorStatus=""),C.util.isTrue(t.clearTarget)&&(i.innerHTML="");var r=e.html,s=e.matchedAdCount;if((t.container===D.container.div&&C.util.isNumber(s)||0<r.indexOf('data-ad-format="')&&0<r.indexOf("adsbygoogle.js"))&&0===C.util.filter(D.syncAds,function(e){return 0<r.indexOf(e)}).length){if(t.container=D.container.div,0<i.getElementsByTagName("div").length){if(!C.util.isObject(t.refresh))return;i.innerHTML=""}return J.showTargetDiv(i,t),i.innerHTML=E.getAdContentOnly(r,t.widgetId),C.util.loadScriptElements(i,t.widgetId),C.lib.doDebug(t,P.getElementById(t.widgetId),i),!0}if(t.container=D.container.iframe,!C.util.find(i.childNodes,function(e){return e.id===t.widgetId})){var a=C.util.filter(i.childNodes,function(e){var t=e?e.id:"";return t&&0===t.indexOf(D.widgetIdPrefix)})||[];t.serverUrl=null;var o=J.insIframe(t,i),u=E.getScriptOverride();u&&(r=r.replace(/<script type="?text\/javascript"? src="?https?:\/\/[A-Za-z_0-9:.-]{5,50}\/adn.(src.)?js"?><\/script>/g,'<script type="text/javascript" src="'+u+'" id="'+c+'"><\/script>')),t.isolateSubFrame&&(r=r.replace(/<iframe/g,"<iframe sandbox='"+g+"'"));var d="<body id='"+t.widgetId+"' "+m+"='"+C.util.isTopWindow()+"'";if(t.env&&t.env!==D.env.production.id&&(d+=" "+v+"='"+t.env+"'"),t.dn&&(d+=" "+b+"='"+t.dn+"'"),r=r.replace("<body",d),E.supportsSrcDoc()&&t.isolateFrame)o.setAttribute("srcdoc",r);else{var l=o.contentDocument||o.contentWindow;l&&l.document&&(l=l.document),l||C.out.devOutput("Couldn't find iframeDoc","showAdContent",i,o,l),l.open(),l.write(r),l.close()}return C.util.forEach(a,function(e){e.style.display="none"}),C.lib.doDebug(t,o,i),!0}}}}(),i="012356789bcdfghjklmnpqrstvwxyz",E={uuid:function(){for(var e="",t=0;t<24;t++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},supportsSrcDoc:function(){return"srcdoc"in P.createElement("iframe")},isSrcdocFrame:function(){return"about:srcdoc"===E.getLocationHref()||"null"===T.location.origin},getLocationHref:function(){return T.location.href},supportsIntersectionObserver:function(){return"IntersectionObserver"in T&&"IntersectionObserverEntry"in T&&"intersectionRatio"in T.IntersectionObserverEntry.prototype},getParam:function(e,t){if(C.util.isObject(e))return e[t]},getNewViewability:function(){return{maxPercent:0,prevPercent:0,timeNone:0,timePartly:0,timeHalf:0,timeFully:0,timeIntersect:0,timeStart:0,isViewed:!1}},onDocReady:function(e){"complete"===P.readyState||"interactive"===P.readyState?e():C.util.addEventListener(T,"DOMContentLoaded",e)},onLoad:function(e){"complete"===P.readyState?e():C.util.addEventListener(T,"load",e)},getAdsFromContainer:function(e){return C.util.filter(e.getElementsByTagName("div"),function(e){return-1<e.className.indexOf(D.cwClass)&&0===e.id.indexOf(D.adIdPrefix)})},isVisible:function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},generateAdData:function(e,t,i){return e&&e.ads?e.ads:t&&t.ads&&i?C.util.map(t.ads,function(e){var t=i[e.id];return{adId:e.id,dims:e.dims,definedDims:t?t.definedDims:e.definedDims}}):[]},getAdsInfo:function(e){var t={contentDims:{},definedDims:{},adUnitContainerId:e,ads:[]};try{if(t.adsDivEl=P.getElementById(e),!t.adsDivEl)return{};t.contentDims=C.util.getElementDimensions(t.adsDivEl),t.ads=C.util.map(E.getAdsFromContainer(t.adsDivEl),function(e){return{id:e.id,el:e,definedDims:{w:E.dimForAttr(e.getAttribute("data-creative-width")),h:E.dimForAttr(e.getAttribute("data-creative-height"))},dims:C.util.getElementDimensions(e)}})}catch(e){t.contentDims={}}return t},loadScriptSrc:function(e,t,i,n){if(!C.util.isString(e))return C.out.output("src should be a string","loadScriptSrc",e);try{var r=P.createElement("script");C.util.forEach(i,function(e,t){r.setAttribute(t,e)}),C.util.isStringWithChars(n)&&(r.innerHTML=n),r.src=e;var s=t?P.getElementById(t):null;if(s)s.appendChild(r);else{var a=P.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a)}}catch(e){return C.out.output(e,"loadScriptSrc: in catch block")}},dimForAttr:function(e){if(C.util.isString(e)){var t=C.util.trim(e),i=parseInt(t,10);return C.util.endsWith(t,"px")?i:i.toString(10)===t?i:e}return C.util.isNumber(e)?e:""},addWidgetIdToProcessAd:function(e,t){var i="adn.inIframe.processAdResponse({ widgetId: '"+t+"', ",n='adn.inIframe.getIframeId("'+t+'"';return e.replace(/adn.inIframe.processAdResponse\({/g,i).replace(/adn.inIframe.getIframeId\(/g,n)},loadScriptContent:function(e,t,i){if(!C.util.isString(e))return C.out.output("content should be a string","loadScriptContent",e);try{var n=P.createElement("script");C.util.forEach(i||{},function(e,t){n.setAttribute(t,e)});var r=P.createTextNode(e);n.appendChild(r),(P.getElementById(t)||P.body).appendChild(n)}catch(e){return C.out.output(e,"loadScriptContent: in catch block")}},applyStyle:function(i,e){return C.util.forEach(e,function(e,t){i.style[t]=e})},parseHashArgs:function(){var e,t;return E.decodeUrlEncodedPairs((e=T.location.href||"",-1<(t=e.indexOf("#"))?e.substr(t+1):""))},parseUrlArgs:function(){return E.decodeUrlEncodedPairs(T.location.search)},clone:function(e){var t=C.util.isObject(e)?{}:C.util.isArray(e)?[]:null;return t?E.assign(t,e):e},assign:function(i,e){return C.util.forEach(e,function(e,t){C.util.isObject(e)?(C.util.isObject(i[t])||(i[t]={}),E.assign(i[t],e)):C.util.isArray(e)?(C.util.isArray(i[t])||(i[t]=[]),function(e,t){for(var i=0;i<t.length;i++)e.push(E.clone(t[i]))}(i[t],e)):i[t]=e}),i},isWidgetId:function(e){var t=C.util.isString(e)?e:E.getParam(e,"widgetId");return C.util.isString(t)&&0===t.indexOf(D.widgetIdPrefix)},copyArgValues:function(i,e,n){return C.util.isArray(n)&&C.util.isObject(i)&&C.util.isObject(e)?(C.util.forEach(e,function(e,t){C.util.isDefined(e)&&C.util.hasValue(n,t)&&(i[t]=e)}),i):C.out.output("Args not sufficient","copyArgValues",i,e,n)},decodeUrlEncodedPairs:function(e){if(!C.util.isString(e))return C.out.output("urlEncodedPairs should be a string","decodeUrlEncodedPairs");for(var t={},i=e.replace(/\?/,"").replace(/#/,"").split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(2===r.length){var s=decodeURIComponent(r[0]),a=decodeURIComponent(r[1]);C.util.isDefined(t[s])?(C.util.isArray(t[s])||(t[s]=[t[s]]),t[s].push(a)):t[s]=a}}return t},combineArgs:function(){for(var e={},t=arguments.length,i=0;i<t;i++){var n=arguments[i];C.util.isObject(n)&&E.assign(e,arguments[i])}return e},getQueryParamsByName:function(e){if(!C.util.isString(e)||C.util.isBlankString(e))return null;var t=E.getLocationHref(),i=e.replace(/[[\]]/g,"\\$&"),n=new RegExp("[?&]"+i+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},encodeAsUrlParams:function(e,t){if(C.util.isString(e))return e;var n=[];if(C.util.forEach(e,function(e,t){var i=encodeURIComponent(t)+"=";C.util.isArray(e)?C.util.forEach(e,function(e){n.push(i+encodeURIComponent(C.util.isObject(e)?JSON.stringify(e):e))}):C.util.isObject(e)?n.push(i+encodeURIComponent(JSON.stringify(e))):C.util.isDefined(e)&&!C.util.isBlankString(e)&&n.push(i+encodeURIComponent(e))}),0===n.length)return"";var i=n.join("&");return t?"&"+i:i},isAdnPrice:function(e){return C.util.isObject(e)&&C.util.isNumber(e.amount)&&0<e.amount&&C.util.isString(e.currency)&&3===e.currency.length},postMessageToParent:function(e){return C.util.isObject(T.parent)&&T.parent.postMessage&&C.util.isObject(e)?e.isDivContainer?B.handlePostMessage(e):(e[D.postMessageSrcKey]=D.postMessageSrcValue,void T.parent.postMessage(JSON.stringify(e),"*")):C.out.output("Attributes not sufficient","postMessageToParent")},postMessageToChild:function(e,t){return C.util.isObject(t)?C.util.isTrue(t.isDivContainer)?B.handlePostMessage(t):e&&e.contentWindow?e.contentWindow.postMessage?(t[D.postMessageSrcKey]=D.postMessageSrcValue,void e.contentWindow.postMessage(JSON.stringify(t),e.src||"*")):C.out.output("Childframe doesn't support postMessage","postMessageToChild",e,t):C.out.output("Childframe isn't really a child frame","postMessageToChild",e,t):C.out.output("Expected an object for a message","postMessageToChild",t)},dataOutput:function(e,t){return e+": "+(C.util.isObject(t)||C.util.isArray(t)?JSON.stringify(t):t)+" | "},ampCheck:function(e,t){e&&"amp"===e.mode&&T.context&&C.util.isFunction(T.context.renderStart)&&(t&&0===t.width?T.context.noContentAvailable():T.context.renderStart(t||void 0))},getUnixTimestamp:function(e,t){var i=e/(t?1440:1);return Date.now()+(C.util.isNumber(e)&&0<e?864e5*i:0)},getDocEl:function(e){if(e.targetClass){var t=P.getElementsByClassName(e.targetClass);return C.util.find(t,function(e){return!e.hasChildNodes()})||t[0]}if(e.duplicateId){var i=P.querySelectorAll("*[id='"+e.targetId+"']");return C.util.find(i,function(e){return!e.hasChildNodes()})||i[0]}return P.getElementById(e.targetId)},isTestAddress:function(e){return!!(C.util.isString(e)&&0===e.indexOf("http://localhost")&&0<e.indexOf("/test"))&&(d=!0)},isUnitTest:function(){return-1<T.location.href.indexOf("http://localhost:9876/context.html")},getEnvFromHref:function(t){if(t&&C.util.isString(t))return C.util.find(D.env,function(e){return t===e.as||0<t.indexOf("://"+e.as)})},getAdContentOnly:function(e,t){var i="</body>",n=e.indexOf('<div id="adn-rsp-'),r=e.indexOf(i);if(!(n<1||r<1)){var s=e.substring(n,r);return s='<div id="'+t+'">'+s+"</div>",E.addWidgetIdToProcessAd(s,t)}C.out.output("Something unexpected has gone on with the content of the ad server response","getAdContentOnly",i,r,e)},gatherDataParams:function(e,t,i,n){var r=[],s={},a=C.util.isFunction(t)?t:function(){return!0},o=C.util.isFunction(i)?i:C.util.noop,u=n||{},d=["auId","creativeId","networkId","targetId","c","kv","keywords","replacements","ps","auml","floorPrice"],l=[{server:"userSegments",script:"userSegments"},{server:"context",script:"ctx"},{server:"canonical",script:"canonical"}];return C.util.forEach(e,function(t){if(!0===a(t)){var i={};C.util.forEach(d,function(e){i[e]=t[e]}),t.floorPrice&&!E.isAdnPrice(t.floorPrice)&&(C.out.output("Floor price is not valid","gatherDataParams",t),delete i.floorPrice),r.push(i),C.util.forEach(l,function(e){s[e.server]=s[e.server]||t[e.script]}),o(t)}}),C.util.forEach(d,function(e){delete u[e]}),C.util.forEach(l,function(e){delete u[e.server],delete u[e.script]}),{adUnits:r,params:s}},getScriptOverride:function(){if(C.util.isString(e))return e;var t=E.getQueryParamsByName("script-override");return e="",C.util.isString(t)&&0<t.length&&(e=(C.util.find(D.scriptOverride,function(e){return e.id===t})||{}).url||""),e},gatherExclusions:function(e){function t(e,t,i){C.util.isArray(t[i])&&0<t[i].length&&(e[i]=t[i])}var i={};return C.util.isArray(e)?C.util.forEach(e,function(e){t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")}):(t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")),i},encodeUrlParams:function(e,t,i){var n=i||{};E.copyArgValues(t,n,["auml","ps","c"]),n.keywords&&(t.keywords=n.keywords.slice(0,20)),n.kv&&(t.kv=JSON.stringify(n.kv)),n.ctx&&(t.ctx=n.ctx),n.canonical&&(t.canonical=n.canonical),n.replacements&&(t.replacements=JSON.stringify(n.replacements)),n.userSegments&&(t.userSegments=JSON.stringify(n.userSegments)),E.isAdnPrice(n.floorPrice)?t.fp=JSON.stringify(n.floorPrice):n.floorPrice&&C.out.output("Not a valid floorprice supplied.","encodeUrlParams",n);try{return e+=E.encodeAsUrlParams(t,!0)}catch(e){return C.out.output("encoding urls failed","insIframe: catch block",e)}},setAndReturnMetaData:function(e){var t=e,i=H.getAllAdvStorageAsObj();return C.util.hasProperties(i)&&((t=t||{}).metaData=i),t},normalise:function(i){var n={auW:"auW",auH:"auH"};return C.util.forEach(i,function(e,t){n[t]&&(i[t]=e.toString())}),i}};var F,j,W,V=function(){var e=E.getQueryParamsByName("adnMeta");if(C.util.isStringWithChars(e)){var t,i=T.atob(e);try{t=JSON.parse(i)}catch(e){return C.out.output("JSON Parse string for adnMeta failed","regDestination",i)}H.writeAdvLs(t)}},B={handleChildPageLoad:function(e,t){var i=E.getAdsInfo(C.inIframe.getResponseCtrId());if(!i.adsDivEl)return C.out.devOutput("Can't find container ID","handleChildPageLoad",C.inIframe.getResponseCtrId());if(e.pageLoadBeforeProcessAd||C.util.isArray(i.ads)&&i.ads.length&&x[i.ads[0].id]){var n=C.inIframe.getIframeId();if(!n)return C.out.devOutput("Can't find a widget ID","handleChildPageLoad",e);var r=C.inIframe.isResizeToContent(),s=C.util.isNumber(t)?t:0,a=0<s?D.postMessageType.toParentResize:D.postMessageType.toParentPageLoad,o=i.adsDivEl.getElementsByTagName("iframe")[0];if(o){var u=C.util.getElementDimensions(o);u.w>i.contentDims.w&&(i.contentDims.w=u.w),u.h>i.contentDims.h&&(i.contentDims.h=u.h)}(i.contentDims.w<1||i.contentDims.h<1)&&s<1&&(r=!1);var d=E.assign({},x);if(C.util.forEach(x,function(e){e.dims=i.contentDims}),r||a===D.postMessageType.toParentPageLoad){var l={widgetId:n,messageType:a,w:i.contentDims.w,h:i.contentDims.h,retAdCount:i.ads.length,dims:i.contentDims,ads:E.generateAdData(null,i,d),resizeToContent:r};E.postMessageToParent(l)}0<i.contentDims.w&&0<i.contentDims.h&&9<s||(s<10||!E.isVisible(i.adsDivEl))&&T.setTimeout(function(){B.handleChildPageLoad({},s+1)},s<10?295:1500)}else T.setTimeout(function(){B.handleChildPageLoad({pageLoadBeforeProcessAd:!0})},50)},handleChildSubs:function(e,t){if(!t.widgetId)return C.out.devOutput("Cannot find widget ID","handleChildSubs",e,t);var i=P.getElementById(t.widgetId);if(!i)return C.out.output("Cannot find widget","handleChildSubs",e,t);var n={messageType:D.postMessageType.toChildPubs,windowDims:C.util.getWindowDims(),widgetDims:C.util.getElementDimensions(i),widgetParentDims:C.util.getElementDimensions(i.parentElement),widgetId:t.widgetId,event:t.event,isDivContainer:t.isDivContainer};C.util.isDefined(t.functionCalls)&&(n.functionCalls=t.functionCalls),E.postMessageToChild(i,n)},handlePostMessage:function(t){if(!C.util.isObject(t))return C.out.output("Handle post aMessage is being used in weird ways","handlePostMessage",t);if(C.util.isString(t.data)||C.util.isTrue(t.isDivContainer)){var i={};if(C.util.isTrue(t.isDivContainer))i=E.clone(t);else{try{i=JSON.parse(t.data)}catch(e){return C.out.devOutput("Couldn't handle parsing","handlePostMessage",t.data,t)}if(i[D.postMessageSrcKey]!==D.postMessageSrcValue)return!1}var n=O[i.widgetId]||{};if(i.messageType===D.postMessageType.toChildPubs){if(!C.util.isString(i.event)||!C.util.isString(i.widgetId))return C.out.output("Requires more data","handlePostMessage",i);var e={widgetId:i.widgetId,event:i.event,windowDims:i.windowDims,widgetDims:i.widgetDims,widgetParentDims:i.widgetParentDims};C.util.isDefined(i.functionCalls)&&(e.functionCalls=i.functionCalls),z.handleChildPubs(e)}else if(i.messageType===D.postMessageType.toChildAdUnitInfo){if(!C.util.isString(i.adUnitInfoId))return C.out.output("Requires more data","handlePostMessage",i);z.handleAdUnitInfo(i)}else if(i.messageType===D.postMessageType.toParentGetAdUnitInfo){if(!C.util.isString(i.adUnitInfoId)||!C.util.hasProperties(n))return C.out.output("Needs ad unit info id and widget id","handlePostMessage",i,n);E.postMessageToChild(P.getElementById(i.widgetId),{adUnitInfoId:i.adUnitInfoId,messageType:D.postMessageType.toChildAdUnitInfo,adUnitInfo:n,isDivContainer:i.isDivContainer})}else if(i.messageType===D.postMessageType.toParentIsolateAdVisibilityEvent){if(!C.util.isString(i.impRequestLoc)||!C.util.isObject(i.spec)||!C.util.isString(i.feedbackText))return C.out.output("Missing required data to send isolate visibility event","handlePostMessage",i);G.sendEventFromParent(i.impRequestLoc,i.spec,i.feedbackText)}else if(i.messageType===D.postMessageType.toParentCustomEvent){if(!C.util.isDefined(i.args)||!C.util.isObject(i.customArgs)||!C.util.isObject(i.pAdSpec))return C.out.output("Missing required data to send custom event info","handlePostMessage",i);C.inIframe.sendCustomEvent(i.args,i.customArgs,i.pAdSpec)}else if(i.messageType===D.postMessageType.toParentFunctions){if(!C.util.hasProperties(n))return C.out.output("Needs valid widget id","handlePostMessage",i,n);if(!i.name)return C.out.output("Needs a function name","handlePostMessage",i,n);if(n.functions&&C.util.isArray(n.functions)){var r=C.util.find(n.functions,function(e){return e&&e.name===i.name&&C.util.isFunction(e.func)});if(r&&C.util.isFunction(r.func)){var s={};E.copyArgValues(s,n,f),r.func(s,i.args)}}}else if(i.messageType===D.postMessageType.toParentAdVisibilityEvent){if(!C.util.hasProperties(n))return C.out.output("Need widget info","toParentAdVisibility",i,n);C.util.isObject(n.refresh)&&i.callbackProp===n.refresh.event&&0<n.refresh.count&&T.setTimeout(function(){var e=n.parentArgs||{},t=E.clone(n.auArgs);t.refresh=E.clone(n.refresh),t.refresh.count--,e.adUnits=[t],C.request(e)},1e3*n.refresh.delay),n[i.callbackProp]&&C.util.isFunction(n[i.callbackProp])&&n[i.callbackProp]({widgetId:i.widgetId,auId:n.auId,adId:i.adId,creativeId:i.creativeId,viewability:i.viewability});var a=P.getElementById(N+n.widgetId);a&&i.debugMessage&&(a.innerHTML+="<div><small>"+i.debugMessage+" - "+i.creativeId+"</small></div>")}else if(i.messageType===D.postMessageType.toParentSubscribe){if(!C.util.isString(i.event)||!C.util.isString(i.widgetId))return C.out.output("Requires on event","handlePostMessage",i);C.util.addEventListener(T,i.event,C.util.createDelegate(B,B.handleChildSubs,{widgetId:i.widgetId,event:i.event,isDivContainer:i.isDivContainer}))}else if(i.messageType===D.postMessageType.toParentPageLoad||i.messageType===D.postMessageType.toParentResize){if(!1!==n.resizeOnPageLoad&&(!C.util.isFunction(n.resizeOnPageLoad)||!1!==n.resizeOnPageLoad(i))&&C.util.isTrue(i.resizeToContent)){var o={};E.copyArgValues(o,n,f),E.copyArgValues(o,i,f),K.iframeResizer(o,!1)}if(i.messageType===D.postMessageType.toParentPageLoad&&C.util.isFunction(n.onPageLoad)){var u={};E.copyArgValues(u,n,f),E.copyArgValues(u,i,f),n.onPageLoad(E.normalise(u))}}else{if(!C.util.isString(i.method))return C.out.output("args should have a method to call","handlePostMessage");try{i.functionContext===D.functionContext.inIframe?C.util.isFunction(z[i.method])?z[i.method].call(C.inIframe,i):C.inIframe[i.method].call(C.inIframe,i):K[i.method].call(K,i)}catch(e){return C.out.output(e,"catch block for calling method",i,e)}if(i.messageType===D.postMessageType.toParentImpression){if(E.copyArgValues(n,i,["retAdsW","retAdsH","retAdCount"]),C.util.isFunction(n.onImpressionResponse)){var d={};E.copyArgValues(d,n,f),E.copyArgValues(d,i,f),n.onImpressionResponse(E.normalise(d))}B.handleChildSubs({},{event:"impRegistered",widgetId:i.widgetId,functionCalls:(n.functionCalls||[]).concat(n.cachedFunctionCalls),isDivContainer:i.isDivContainer})}}}},registerListeners:function(){C.util.addEventListener(T,"message",C.util.createDelegate(C.lib,B.handlePostMessage)),C.util.isTopWindow()||C.util.addEventListener(T,"load",C.util.createDelegate(C.lib,B.handleChildPageLoad))},setFeedbackOptions:function(e){C.util.isObject(e)&&(C.util.isString(e.console)&&D.feedback.console[e.console]&&(U.console=e.console),C.util.isString(e.inScreen)&&D.feedback.inScreen[e.inScreen]&&(U.inScreen=e.inScreen)),0<T.location.href.toLowerCase().indexOf("adndebug123")&&(U.inScreen=D.feedback.inScreen.inAdUnit);var t=E.getQueryParamsByName("console")||(C.util.getFrameElement()?C.util.getFrameElement().getAttribute(l):null);C.util.isString(t)&&D.feedback.console[t]&&(U.console=t);var i=E.getQueryParamsByName("inScreen");C.util.isString(i)&&D.feedback.inScreen[i]&&(U.inScreen=i)}},H=(j={userId:"cX_P"},{getEuConsentAsObj:function(e){var t=e&&e.consentString?e.consentString:H.get("euconsent-v2")||H.get("euconsent");if(C.util.isStringWithChars(t))return{consentString:t}},getAdnConsentAsObj:function(){var e=H.get("adnconsent"),t={};C.util.isStringWithChars(e)&&(t.adnConsent=e);var i=H.get("abnconsent");return C.util.isStringWithChars(i)&&(t.abnConsent=i),t},getAllIdsAsObj:function(){var e=[],t=H.get(j.userId);t&&e.push({CXENSE:{userId:t}});var i=H.get(W.userId);if(i&&e.push({RELAY42:{userId:i}}),!(e.length<1))return{userAliases:JSON.stringify(e)}},getIdsAsObj:function(e){var t={userId:e.userId||H.getAllDatStorageAsObj().browserId,sessionId:e.sessionId};return t.userId||delete t.userId,t.sessionId||delete t.sessionId,t},get:function(e){for(var t=e?e+"=":null,i=t?null:{},n=decodeURIComponent(P.cookie).split(";"),r=0;r<n.length;r++){for(var s=n[r];" "===s.charAt(0);)s=s.substring(1);if(t){if(0===s.indexOf(t))return s.substring(t.length,s.length)}else{var a=s.split("=");i[a[0]]=a[1]}}return C.util.isObject(i)?i:""},set:function(e){C.util.forEach(e,function(e,t){var i=new Date;i.setTime(i.getTime()+2592e6);var n="; expires="+i.toUTCString();P.cookie=t+"="+(e||"")+n+"; path=/"})},clearAdvLocalStorage:function(){try{T.localStorage.removeItem(o),T.localStorage.removeItem(a),T.sessionStorage.removeItem(a)}catch(e){C.out.devOutput("Problem clearing adv local storage","clearAdvLocalStorage",e)}},writeConsent:function(t){if(!t||!C.util.isArray(t))return C.out.devOutput("Not a valid consent object","writeConsent",t);if(h){var i=[];C.util.forEach(t,function(e){u[e]===e?i.push(e):C.out.devOutput("Invalid consent item","writeConsent",t)});try{i.length<1?T.localStorage.removeItem(o):T.localStorage.setItem(o,JSON.stringify(i))}catch(e){C.out.devOutput("Problem setting item","writeConsent",e,i)}}},getConsent:function(){return h?Z(o):[]},writeAdvLs:function(t){if(!C.util.isObject(t)||!C.util.hasProperties(t))return C.out.devOutput("Not an object of data","writeAdvLs");if(h){var i=[],e=Z(a,!0),n=ee();C.util.forEach(e,function(e){C.util.isStringWithChars(e.value)&&C.util.isStringWithChars(e.key)&&!t[e.key]&&e.exp&&e.exp>E.getUnixTimestamp()&&i.push(e)}),C.util.forEach(t,function(e,t){-1<t.indexOf("session")?n[t]=e:C.util.isStringWithChars(t)&&i.push({exp:E.getUnixTimestamp(100),key:t,value:e})});var r={};C.util.forEach(n,function(e,t){r[t]=e});try{T.sessionStorage.setItem(a,JSON.stringify(r)),T.localStorage.setItem(a,JSON.stringify(i))}catch(e){C.out.devOutput("Problem setting item","writeAdvLs",e,r,i)}}else H.clearAdvLocalStorage()},writeDatSegments:function(e){if(!C.util.isObject(e)||!C.util.hasProperties(e))return C.out.devOutput("Not an object of data","writeDatLs");var i={};C.util.forEach(e,function(e,t){"segments"===t&&(i[t]=e)}),i.segments||(i.segments=[]),i.exp=E.getUnixTimestamp(1,!0);try{(h?T.localStorage:T.sessionStorage).setItem(r,JSON.stringify(i))}catch(e){C.out.devOutput("Problem setting item","writeDatSegments",e,i)}},getDatSegments:function(){var e={};try{if(!(e=E.assign({},E.assign($(T.sessionStorage,r),$(T.localStorage,r))))||!e.exp||e.exp<=E.getUnixTimestamp())return T.localStorage.removeItem(r),T.sessionStorage.removeItem(r),{}}catch(e){return C.out.devOutput("Problem getting dat segments","getDatSegments",e),{}}return delete e.exp,e.segments=e.segments||[],e},writeDatLs:function(e){if(!C.util.isObject(e)||!C.util.hasProperties(e))return C.out.devOutput("Not an object of data","writeDatLs");if(h){var i={},n={};C.util.forEach(e,function(e,t){0===t.indexOf("sessionId")?i[t]=e:0===t.indexOf("browserId")?n[t]=e:0===t.indexOf("extSync")&&(n[t]=e)});try{T.sessionStorage.setItem(t,JSON.stringify(i)),T.localStorage.setItem(t,JSON.stringify(n))}catch(e){C.out.devOutput("Problem setting item","writeDatLs",e,i,n)}}},getAllDatStorageAsObj:function(){if(!h)return{};try{return E.assign($(T.sessionStorage,t),$(T.localStorage,t))}catch(e){return C.out.devOutput("Problem with local storage","getAllDatStorageAsObj",e),{}}},getAllAdvStorageAsObj:function(){return h?E.assign(Z(a),ee()):{}}}),z={},J={distributeComposedAds:function(a){var o=!1,u=[],d="";C.util.forEach(a.adUnits||a,function(t){var e=C.util.find(O,function(e){return e.targetId===t.targetId&&e.adStatus===D.adStatus.init});if(e)if(e.ads=t.ads,e.returnedKeywords=a.keywords,e.returnedSegments=a.segments,d=e.renderedImpRequestLoc,0<t.matchedAdCount&&0<t.html.indexOf("adnOptionContainerDiv")&&(e.container=D.container.div),0<t.matchedAdCount&&0<t.html.indexOf("adnOptionContainerIframe")&&(e.container=D.container.iframe),0===t.matchedAdCount){e.adStatus=D.adStatus.processed;var i=E.copyArgValues({matchedAdCount:t.matchedAdCount,html:t.html},e,["auId","targetId","auW","auH","kv","keywords","userSegments","c","ps","replacements","auml","floorPrice","requestArgs"]);i.retAdCount=0,i.retAdsW=0,i.retAdsH=0,i.h=0,i.w=0,C.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(i),C.util.isFunction(e.onPageLoad)&&e.onPageLoad(i),E.ampCheck(e,{width:0,height:0})}else if(E.getParam(e.requestParams,"load")!==D.loadEnums.lazy||e.withinBounds){E.ampCheck(e);var n=C.lib.showAdContent(e,t);C.util.isTrue(n)&&(e.adStatus=D.adStatus.distributed,C.util.forEach(t.rts||[],function(e){u.push(e)}))}else{o=!0,e.adStatus=D.adStatus.procured,t.renderedImpRequestLoc=d;var r=E.getDocEl(e),s=k[t.targetId];r&&s?(s.errorStatus="",J.showTargetDiv(r,e),r.style.width=C.util.dimension(e.auW),r.style.height=C.util.dimension(e.auH)):(s.errorStatus=D.errorStatus.noTarget,C.out.output("Unable to find target element","distributeComposedAds",e))}else C.out.output("No ad unit data found, mismatched target probably or not the right status","composed",e)}),C.lib.sendRenderedImps(u,d),o&&G.initProximity()},showTargetDiv:function(e,t){e&&(C.util.isString(t.display)&&e.style.display!==t.display?e.style.display=t.display:"none"===e.style.display&&(e.style.display="block"))},insIframe:function(e,t){var i=t&&t.targetId===e.targetId||E.getDocEl(e);if(!i&&"script"!==e.format)return C.out.warn("Unable to find HTML element on page with the following id or class: "+e.targetId+" - "+e.targetClass),C.out.output("No targetId was found.","insIframe");var n=P.createElement("iframe");n.id=e.widgetId,n.name=e.widgetId,n.setAttribute(m,C.util.isTopWindow()),n.allowTransparency=!0,n.setAttribute(l,U.console);var r={ifrId:n.id};if(e.serverUrl){e.env&&e.env!==D.env.production.id&&D.env[e.env]&&(r[v]=e.env),e.dn&&(r[b]=e.dn);var s=E.encodeUrlParams(e.serverUrl,r,e);if(5<e.serverUrl.length){s+=E.encodeAsUrlParams(H.getIdsAsObj(e),!0),s+=E.encodeAsUrlParams(H.getAllIdsAsObj()||{},!0),s+=E.encodeAsUrlParams(H.getEuConsentAsObj(e)||{},!0);var a=H.getConsent();if(0<a.length&&(s+=E.encodeAsUrlParams({consent:a},!0)),e.gdpr&&(s+=E.encodeAsUrlParams({gdpr:e.gdpr},!0)),!C.util.isTopWindow()){var o={"data-parent-top":!1};s+=E.encodeAsUrlParams(o,!0)}}if(!s)return C.out.output("Failure to create server src","insIframe",s);n.src=s}if(n.setAttribute("style","display: block; margin: 0; borderWidth: 0; padding: 0;"),n.setAttribute("scrolling","no"),n.frameBorder="0",e.isolateFrame&&E.supportsSrcDoc()&&n.setAttribute("sandbox",g),"script"===e.format){var u=n.src;u+=E.encodeAsUrlParams({format:"script"},!0),P.write("<script src='"+u+"'><\/script>")}else n.width=C.util.isString(e.auW)||0<e.auW?e.auW:0,i.style.width=C.util.isNumber(e.auW)&&0<e.auW?C.util.dimension(n.width):n.width,n.height=C.util.isString(e.auH)||0<e.auH?e.auH:0,i.style.height=C.util.isNumber(e.auH)&&0<e.auH?C.util.dimension(n.height):n.height,i.appendChild(n);return J.showTargetDiv(i,e),n}},G=(F=!(W={userId:"_svtri"}),{sendEventFromParent:function(e,t,i){Q(e,t,i)},sendClick:function(e){Q(e,null,"Click")},sendVisibilityImpressions:function(){Y("visible","visibilityStatus","visible","visibleSent","Visible","onVisible")},sendViewableImpressions:function(){Y("viewable","viewabilityStatus","viewed","viewSent","Viewable","onViewable")},cancelProximityListeners:function(){C.util.detachEventListener(T,"resize",G.takeProximity),C.util.detachEventListener(T,"scroll",G.takeProximity)},cancelViewabilityListeners:function(){C.util.detachEventListener(T,"resize",G.takeViewability),C.util.detachEventListener(T,"scroll",G.takeViewability)},initViewability:function(){C.util.isTopWindow()&&(G.takeViewability(),!1===F&&(F=T.setInterval(G.takeViewability,203)),C.util.addEventListener(T,"resize",G.takeViewability),C.util.addEventListener(T,"scroll",G.takeViewability))},initProximity:function(){C.util.isTopWindow()&&(G.takeProximity(),C.util.addEventListener(T,"resize",G.takeProximity),C.util.addEventListener(T,"scroll",G.takeProximity))},takeProximity:function(){var p,m,e=C.util.filter(O,function(e){return(e.adStatus===D.adStatus.procured||E.getParam(e.requestParams,"load")===D.loadEnums.lazyRequest)&&!e.withinBounds});if(0===e.length)return G.cancelProximityListeners(),C.out.devOutput("No more ads to proximity check","takeProximityReading",O);if(C.util.isTopWindow()){try{p=C.util.getWindowSize()}catch(e){C.out.output("takeProximityReading window size calcs off",e)}try{m=C.util.getScrollPos()}catch(e){C.out.output("takeProximityReading scroll calcs off",e)}var v=[],h="";C.util.forEach(e,function(e){try{var t=E.getDocEl(e);if(!t)return void C.out.devOutput("Missing appearance of element","takeProximity",t,e);var i=t.style.display;"none"===i.toLowerCase()&&(t.style.display="block");var n=C.util.getElementPosition(t),r=(t.offsetWidth,t.offsetHeight),s=C.util.isNumber(E.getParam(e.requestParams,"proximity"))?E.getParam(e.requestParams,"proximity"):D.defaultProximity,a=m.top,o=(m.left,m.top+p.height),u=m.left+p.width,d=n.top,l=n.left,c=n.top+r;if(n.left,d-o<s&&-1*s<c-a&&l-u<s&&(e.withinBounds=!0,e.adStatus===D.adStatus.procured)){e.adStatus=D.adStatus.distributed;var g=k[e.targetId];if(!C.util.isObject(g))return C.out.output("Can't find composed ad details","proximity",k,e);var f=C.lib.showAdContent(e,g);C.util.isTrue(f)&&(C.util.forEach(g.rts||[],function(e){v.push(e)}),h=g.renderedImpRequestLoc)}t.style.display=i}catch(e){C.out.output("some catch error for takeProximityReading",e)}}),C.lib.sendRenderedImps(v,h)}},takeViewability:function(e){var h,y,b=!1,w=!1,I=C.util.isTrue(e),t=C.util.isTopWindow()&&!I?O:x,i=C.util.filter(t,function(e){return e.displayStatus===D.displayStatus.displayed&&e.viewabilityStatus===D.viewabilityStatus.notViewed&&!e.isNested&&!e.preview});if(0===i.length)return G.cancelViewabilityListeners(),T.clearInterval(F),F=!1,C.util.isTopWindow()&&!I||E.postMessageToParent({messageType:D.postMessageType.toParentAllChildrenViewed,widgetId:C.inIframe.getIframeId(),functionContext:D.functionContext.parent,method:"allChildrenViewed"}),C.out.devOutput("No more ads to viewability check","takeViewabilityReadings",O,x,C.util.isTopWindow());try{(h=C.util.getWindowSize()).width=Math.max(h.width,1),h.height=Math.max(h.height,1),M.prevWindowWidth===h.width&&M.prevWindowHeight===h.height||(M.prevWindowWidth=h.width,M.prevWindowHeight=h.height)}catch(e){C.out.output("takeViewabilityReading window size calcs off",e)}try{y=C.util.getScrollPos(),M.prevScrollLeft===y.left&&M.prevScrollTop===y.top||(M.prevScrollLeft=y.left,M.prevScrollTop=y.top),M.maxViewLeft=Math.max(y.left+h.width,M.maxViewLeft),M.maxViewTop=Math.max(y.top+h.height,M.maxViewTop)}catch(e){C.out.output("takeViewabilityReading scroll calcs off",e)}var S,A=(new Date).getTime();if(I){M.childPrevTime=M.childPrevTime||{};var n=i[0].widgetId;M.childPrevTime[n]=M.childPrevTime[n]||(new Date).getTime(),S=A-M.childPrevTime[n],M.childPrevTime[n]=A}else M.prevTime=M.prevTime||(new Date).getTime(),S=A-M.prevTime,M.prevTime=A;C.util.forEach(i,function(e){try{var t=P.getElementById(e.adId||e.widgetId);if(!t)return e.viewabilityStatus=D.viewabilityStatus.divMissing,void C.out.devOutput("Missing div","takeViewabilityReading",e);var i=C.util.getElementPosition(t),n={width:Math.max(t.offsetWidth,1),height:Math.max(t.offsetHeight,1)},r=Math.max(i.left,y.left),s=Math.min(i.left+n.width,y.left+h.width),a=Math.max(i.top,y.top),o=Math.min(i.top+n.height,y.top+h.height),u=M.metricsFromParent;if(!E.isVisible(t))return;if(u){var d=u.overlapPos.left+y.left,l=u.overlapPos.left+u.overlapSize.width+y.left,c=u.overlapPos.top+y.top,g=u.overlapPos.top+u.overlapSize.height+y.top;r=Math.max(d,r),s=Math.min(l,s),a=Math.max(c,a),o=Math.min(g,o)}var f=Math.max(s-r,0),p=Math.max(o-a,0),m=Math.round(f*p/(n.width*n.height)*100);if(m>D.defaultVisibilityPercentage&&e.visibilityStatus===D.visibilityStatus.notVisible&&(C.util.isTopWindow()&&!I||(e.visibilityStatus=D.visibilityStatus.visible,w=!0)),100===m&&100===e.viewability.prevPercent&&e.viewability.timeFully<D.longestTime&&(e.viewability.timeFully+=S),50<=m&&50<=e.viewability.prevPercent&&e.viewability.timeHalf<D.longestTime&&(e.viewability.timeHalf+=S),0<m&&0<e.viewability.prevPercent&&e.viewability.timePartly<D.longestTime?e.viewability.timePartly+=S:e.viewability.timeNone+=S,m>e.viewability.maxPercent&&(e.viewability.maxPercent=m),e.viewability.prevPercent=m,(1e3<e.viewability.timeFully||1e3<e.viewability.timeHalf)&&e.viewabilityStatus===D.viewabilityStatus.notViewed&&(C.util.isTopWindow()&&!I||(e.viewabilityStatus=D.viewabilityStatus.viewed,b=!0)),C.util.isTopWindow()&&!I){var v=[A,y.left,y.top,h.width,h.height,i.left,i.top,n.width,n.height,r-i.left,a-i.top,f,p];C.util.forEach(v,function(e,t){v[t]=Math.round(e)}),E.postMessageToChild(t,{messageType:D.postMessageType.toChildViewability,functionContext:D.functionContext.inIframe,method:"updateMetricsFromParent",metricsFromParent:v.join(","),metaData:H.getAllAdvStorageAsObj(),isDivContainer:e.container===D.container.div||e.isDivContainer})}}catch(e){C.out.output("takeViewabilityReading off",e)}}),w&&G.sendVisibilityImpressions(),b&&G.sendViewableImpressions()}}),K={allChildrenViewed:function(e){var t=O[e.widgetId];t&&(t.visibilityStatus=D.visibilityStatus.visible,t.viewabilityStatus=D.viewabilityStatus.viewed)},updateIframe:function(e){return _(e,function(e,t,i){C.util.isDefined(i.w)&&(e.width=i.w),C.util.isDefined(i.h)&&(e.height=i.h);var n=e.parentNode;"relative"===i.stack?(n.style.position="relative",e.style.position="absolute"):"fixed"===i.stack?e.style.position="fixed":"absolute"===i.stack?(C.util.isBlankString(n.style.position)||"relative"!==n.style.position||(n.style.position="static"),e.style.position="absolute"):(C.util.isBlankString(e.style.position)||"static"===e.style.position||(e.style.position="static"),C.util.isDefined(e.width)&&(n.style.width=C.util.dimension(e.width)),C.util.isDefined(e.height)&&(n.style.height=C.util.dimension(e.height))),C.util.isDefined(i.ifrStyle)&&!C.util.isBlankString(i.ifrStyle)&&E.applyStyle(e,i.ifrStyle),C.util.isDefined(i.targetStyle)&&!C.util.isBlankString(i.targetStyle)&&E.applyStyle(n,i.targetStyle),X(t,i)})},triggerViewabilityReading:function(e){_(e,function(e,t){t.adStatus=D.adStatus.processed,t.displayStatus=D.displayStatus.displayed,G.initViewability()})},iframeResizer:function(e,d,l){return _(e,function(e,t,i){var n=parseInt(i.w,10),r=parseInt(i.h,10),s=C.util.isDefined(l)?l:t.collapsible;if(n<0||r<0)return C.out.output("Invalid width ("+i.w+") and height ("+i.h+") for resize","iframeResizer");var a=0===n,o=0===r;if((a||o)&&!s)return C.out.devOutput("Resize to zero not allowed -- ad unit is not collapsible","iframeResizer",i,s);e.width=i.w,e.height=i.h;var u=e.parentNode;u.style.width=C.util.dimension(i.w),u.style.height=C.util.dimension(i.h),(a||o)&&d&&(e.style.display="none",u.style.display="none"),X(t,i)})},styleFromAds:function(e){if(!E.isWidgetId(e.widgetId))return C.out.devOutput("missing widget ID","styleFromAds",e);var t=parseInt(e.retAdCount,10),i=O[e.widgetId],n={};if(E.copyArgValues(n,i,f),0===t)n=E.assign(n,{w:0,h:0,retAdCount:0,ads:[]}),K.iframeResizer(n,U.inScreen!==D.feedback.inScreen.inAdUnit);else{if(!(C.util.isNumber(t)&&0<t))return C.out.output("adCount is not valid: "+t,"styleFromAds");if(!i||!C.util.hasProperties(i))return C.out.output("Missing widget spec","styleFromAds",e);i.displayStatus=D.displayStatus.displayed,G.initViewability(),n=E.assign(n,{w:parseInt(e.retAdsW,10),h:parseInt(e.retAdsH,10),retAdCount:e.retAdCount,ads:E.generateAdData(e)}),K.iframeResizer(n,!1,!1)}}};function _(e,t,i){if(!E.isWidgetId(e.widgetId))return C.out.devOutput("Couldn't find a widget ID","checkArgs",e);var n=O[e.widgetId];if(!n&&e.widgetId!==D.previewId)return C.out.output("Couldn't find widget specs for "+e.widgetId,"checkArgs",e);var r=i||P.getElementById(e.widgetId)||P.getElementById(D.previewId);return r?n?t.call(K,r,n,e):void 0:C.out.output("Couldn't find widget in the document","checkArgs",e,r)}function X(e,t){if(C.util.isFunction(e.onRestyle)){var i={};E.copyArgValues(i,e,f),E.copyArgValues(i,t,f),e.onRestyle(E.normalise(i))}}function Q(e,t,i){var n=e,r=!t||!t.rt;try{if(r||(n+=E.encodeAsUrlParams({rt:t.rt},!0)),E.isTestAddress(n)||E.isTestAddress(E.getLocationHref()))C.out.devOutput(i+" being sent","sending"+i+"Event",n);else{var s,a=C.util.getNewAjax(r?"GET":"POST",n,function(){if(a.readyState&&4!==a.readyState)return!1;if((!a.status||200===a.status)&&C.util.isStringWithChars(a.responseText)){var e={};try{e=JSON.parse(a.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block send event",a)}e&&e.metaData&&H.writeAdvLs(e.metaData)}});a.withCredentials=!E.isTestAddress(n),(s=M&&M.metaData?M.metaData:E.setAndReturnMetaData())?a.send(JSON.stringify(s)):a.send()}return 1}catch(e){return C.out.output("sending a "+i+" event failed",e),0}}function Y(i,n,r,s,a,o){C.util.forEach(x,function(e){if(C.util.isStringWithChars(e.rt)||!e.displayStatus){var t=A[i];if(C.util.isString(t)){if(e.displayStatus===D.displayStatus.displayed&&e[n]===D[n][r]){if(E.isSrcdocFrame()?E.postMessageToParent({impRequestLoc:t,spec:e,feedbackText:a,messageType:D.postMessageType.toParentIsolateAdVisibilityEvent}):Q(t,e,a),e[n]=D[n][s],!E.isWidgetId(e.widgetId))return C.out.devOutput("Couldn't find a widget ID","sendImpression",e);E.postMessageToParent({messageType:D.postMessageType.toParentAdVisibilityEvent,widgetId:e.widgetId,adId:e.adId,creativeId:e.creativeId,viewability:e.viewability,callbackProp:o,debugMessage:a+" sent",isDivContainer:e.isDivContainer})}}else C.out.output("Missing a imp request location","send"+a+"Impression",A,i)}else C.out.output("Need a response token on the spec object to send imp","send"+a+"Impression",e)})}function $(t,e){var i=t.getItem(e);if(C.util.isString(i)&&0<i.length)try{return JSON.parse(i)}catch(e){return C.out.output("Error reading from local storage","cookie.getLs",e,t,i)}return{}}function Z(e,t){var i;try{i=$(T.localStorage,e)}catch(e){return C.out.devOutput("Problem with local storage","getLocalStorage",e),{}}if(C.util.isArray(i)||(i=[]),!0===t)return i;if(e===o){var n=[];return C.util.forEach(i,function(e){u[e]===e&&n.push(e)}),n}var r={};return C.util.forEach(i,function(e){C.util.isStringWithChars(e.key)&&(r[e.key]=e.value)}),r}function ee(){var e=$(T.sessionStorage,a);C.util.isObject(e)||(e={});var i={};return C.util.forEach(e,function(e,t){C.util.isStringWithChars(t)&&(i[t]=e)}),i}C.inIframe=function(){var e=!0,t={},n=[],c=[],r=[],s={};E.isTestAddress(T.location.href),z={handleAdUnitInfo:function(e){if(!e||!C.util.isString(e.adUnitInfoId))return C.out.output("Missing ad unit info id for ad unit info response","handleAdUnitInfo",e);var t=s[e.adUnitInfoId];if(!t||!C.util.isArray(t)||t.length<1)return C.out.output("Missing some ad unit info response handlers","handleAdUnitInfo",s,e);var i=e.adUnitInfo,n=E.copyArgValues({},i,["auId","latitude","longitude","adStatus","auH","auW","collapsible","display","c","kv","keywords","replacements","auml","ps","displayStatus","targetId","targetClass","widgetId","functionCalls","functions","requestParams","method","onNoMatchedAds","onImpressionResponse","onPageLoad","usi","siteId","userId","sessionId","segments","userSegments","resizeOnPageLoad","ctx"]);C.util.forEach(t,function(e){e(n)})},handleChildPubs:function(i){if(!C.util.isObject(i)||!C.util.isString(i.widgetId)||!C.util.isString(i.event))return C.out.output("Missing some args","handleChildPubs",i);C.util.forEach(i.functionCalls||[],function(t){if(t.name){var e=C.util.filter(r,function(e){return e.name===t.name&&C.util.isFunction(e.func)&&!0!==e.isCalled});C.util.forEach(e||[],function(e){e.func(t.args),e.isCalled=i.event!==D.events.CUSTOM&&t.event!==D.events.CUSTOM})}else C.out.output("Missing a name parameter for a function call","handleChildPubs",i)}),C.util.forEach(t[i.event]||[],function(e){if(e.widgetId===i.widgetId){var t={};C.util.isObject(i.windowDims)&&(t.windowDims=i.windowDims),C.util.isObject(i.widgetDims)&&(t.widgetDims=i.widgetDims),C.util.isObject(i.widgetParentDims)&&(t.widgetParentDims=i.widgetParentDims),e.cb(t)}})},updateMetricsFromParent:function(e){if(!e||!C.util.isObject(e))return C.out.devOutput("Missing required args","updateMetricsFromParent",e);if(e.metricsFromParent&&!e.isDivContainer){var i=e.metricsFromParent.split(",");C.util.forEach(i,function(e,t){i[t]=parseInt(e,10)}),M.metricsFromParent={updateTime:i[0],scrollPos:{left:i[1],top:i[2]},windowSize:{width:i[3],height:i[4]},widgetPos:{left:i[5],top:i[6]},widgetSize:{width:i[7],height:i[8]},overlapPos:{left:i[9],top:i[10]},overlapSize:{width:i[11],height:i[12]}}}e.metaData&&(M.metaData=e.metaData),C.util.forEach(n,function(e){e()}),n=[],G.takeViewability(C.util.isTrue(e.isDivContainer))}};function g(s,a,o,u,d){var l=!1,c=!1,g=s+"Status",f=D.viewabilityStatus.notViewed,p=D.viewabilityStatus.viewed;-1<s.indexOf("visibility")&&(f=D.visibilityStatus.notVisible,p=D.visibilityStatus.visible),(c=new T.IntersectionObserver(function(e){var t=x[a],i=(new Date).getTime();t[s]=t[s]||E.getNewViewability(),t[g]=t[g]||f;function n(){t[s].timeIntersect=t[s].timeIntersect+(new Date).getTime()-t[s].timeStart,t[g]=p,t[s].eventSent=!0,d(t[s]),T.clearTimeout(l),l=!1,c.disconnect()}if(t[g]===f)if(0<e[0].intersectionRatio&&e[0].intersectionRatio>=o){if(t[s].timeStart=i,u<5)t[s].timeIntersect=Math.max(u,1),n();else{var r=u-t[s].timeIntersect;l=T.setTimeout(n,r)}t[s].isViewed=!0}else l&&0<t[s].timeStart&&(t[s].timeIntersect=t[s].timeIntersect+(new Date).getTime()-t[s].timeStart,t[s].timeStart=0,T.clearTimeout(l),l=!1,t[s].isViewed=!1)},{root:null,rootMargin:"0px",threshold:o})).observe(P.getElementById(a)),s.indexOf("customTiming")<0||C.util.addEventListener(T,"beforeunload",function(){var e=x[a];if(!e[s])return C.out.output("Could not find matching adspec for view","viewCallback",e,s);e[s].eventSent||(e[s].isViewed&&(e[s].timeIntersect=e[s].timeIntersect+(new Date).getTime()-e[s].timeStart),0<e[s].timeIntersect&&d(e[s]),e[s]=null)})}function f(e,t){return e||C.util.find(x,function(e){return e.adId===t})}return{sendCustomEvent:function(a,o,t){var e=E.getParam(a,"id")||a;if(!C.util.isDefined(e)||!C.util.isDefined(o))return C.out.output("Missing an ad ID to perform the custom event","sendCustomEvent",a,o);function i(e){if(E.isSrcdocFrame()&&!t)return E.postMessageToParent({args:a,customArgs:o,pAdSpec:e,messageType:D.postMessageType.toParentCustomEvent});!function(e){if(!C.util.isObject(e))return C.out.output("Need an ad spec to send a custom event","sendCustomEvent",x,a,o);if(!C.util.isString(e.rt))return C.out.output("Need a response token on the spec object to send imp","sendCustomEvent",e,x,a,o);var t=C.lib.getRequestLocs({env:d?"http://localhost:8000/test":C.lib.getEnv(),dn:C.lib.getDn()}).custom;if(e&&O&&O[e.widgetId]&&(t=O[e.widgetId].customRequestLoc),!t)return C.out.output("Need a custom request loc","sendCustomEvent",t,e,x,a,o);var i=E.getParam(o,"events")||[{customType:E.getParam(o,"customType"),customValue:E.getParam(o,"customValue")}],n=[];if(C.util.forEach(C.util.isArray(i)?i:[],function(e){if(C.util.isString(E.getParam(e,"customType"))){var t=parseInt(E.getParam(e,"customValue"),10),i={customType:e.customType,customValue:C.util.isNumber(t)?t:0};0===i.customValue&&delete i.customValue,n.push(i)}else C.out.output("Missing type for the custom event","sendCustomEvent",e,a,o)}),0===n.length)return C.out.output("Found no valid custom events","sendCustomEvent",a,o);try{var r=t+E.encodeAsUrlParams({rt:e.rt},!0);if(E.isTestAddress(r))C.out.devOutput("Custom request loc being send","sending",e,r);else{var s=C.util.getNewAjax("POST",r);s.withCredentials=!E.isTestAddress(r),s.send(JSON.stringify({events:n}))}}catch(e){C.out.output("sending a custom event failed",e,x,a,o)}}(e)}var n=f(t,e);n?i(n):c.push(function(){return i(f(t,e))})},intersectionCallback:function(e,t){if(!C.util.isFunction(t.callback))return C.out.output("Need a callback registered","intersectionCallback",t);var i=E.assign({},t);i.recordType="intersection",i.maxTime=t.maxTime||0,C.inIframe.recordInScreen(e,C.util.isStringWithChars(i.id)?i.id:E.uuid(),i)},recordInScreen:function(t,i,n){if(!E.supportsIntersectionObserver())return C.out.devOutput("Browser doesn't support IntersectionObserver -- cannot do timing.","recordInScreen");var r=E.getParam(t,"id")||t,e=f(null,r),s=parseFloat(E.getParam(n,"threshold"))/100,a=0<=s&&s<=1?s:.5;C.util.isDefined(s)&&a!=s&&C.out.output("Threshold needs to be between 0 and 100. Using default value of "+100*a+" instead.","recordInScreen",n);var o=E.getParam(n,"maxTime"),u=0<=o?o:12e4;if(C.util.isDefined(u)&&o!==u&&C.out.output("Max time needs to be greater than 0. Using default value of "+u+" instead.","recordInScreen",n),!C.util.isStringWithChars(r))return C.out.output("Cannot register in screen without an adId.","recordInScreen",r,i,n);if(!C.util.isStringWithChars(i))return C.out.output("Cannot register in screen without a custom event type.","recordInScreen",r,i,n);function d(){g(l,r,a,u,function(e){if("intersection"===n.recordType)return n.callback({adId:r,id:i,timeIntersect:e.timeIntersect,criteriaMet:e.timeIntersect>=u});C.inIframe.sendCustomEvent(t,{customType:i,customValue:Math.min(e.timeIntersect,u)})})}var l="customTiming"+i;e?d():c.push(function(){d()})},getResponseCtrId:function(){var t,e=P.getElementsByTagName("div");return C.util.forEach(e,function(e){if(0===e.id.indexOf("adn-rsp-"))return t=e,!1;t||0!==e.id.indexOf(D.widgetIdPrefix)||(t=e)}),t?t.id:"responseCtr"},blockViewability:function(e){if(!C.util.isStringWithChars(e))return C.out.output("Need to supply the ad id to block viewability","blockViewability",e);x[e]=x[e]||{},x[e].viewabilityStatus=D.viewabilityStatus.blocked},blockResizeToContent:function(){e=!1},isResizeToContent:function(){return e},getAdRequestInfo:function(e){if(!e||!C.util.isFunction(e.onInfoReceived))return C.out.output("Need onData function populated","getAdRequestInfo",e);var t=e.adUnitInfoId||"adUnitInfoId-"+Math.random();s[t]=s[t]||[],s[t].push(e.onInfoReceived),E.postMessageToParent({messageType:D.postMessageType.toParentGetAdUnitInfo,adUnitInfoId:t,widgetId:C.inIframe.getIframeId()})},registerFunction:function(e,t){if(!e)return C.out.output("Missing important parameters","registerFunction",e);var i=C.util.isString(e)?e:e.name,n=C.util.isFunction(t)?t:e.func;if(!C.util.isString(i)||!C.util.isFunction(n))return C.out.output("Missing important parameters",e);r.push({name:i,func:n})},processAdResponse:function(e){if(!e||!C.util.isNumber(e.matchedAdCount))return C.out.output("Missing the necessary args in "+e,"resizeAds");var t=e.widgetId,i=e.widgetId;if(t||(t=C.inIframe.getIframeId(),i=C.inIframe.getResponseCtrId()),!t&&C.lib.isParentTopWindow())return C.out.devOutput("Unable to find iframeId","processAdResponse",t,e);!function(n,e,t){var i=E.getAdsInfo(e);if(!i.adsDivEl)return C.out.output("Can't find the ads container","processAd",n,e,t,i);A=C.lib.getRequestLocs({env:d?"http://localhost:8000/test":C.lib.getEnv(),dn:C.lib.getDn()},!1);var r=i.adsDivEl&&"div"===i.adsDivEl.tagName.toLowerCase()&&(e!==C.inIframe.getResponseCtrId()||0===e.indexOf(D.widgetIdPrefix)),s=!r&&(!n||!C.lib.isParentTopWindow())||r&&(!n||!C.util.isTopWindow());C.util.forEach(i.ads,function(e){var t=x[e.id]||{};if(x[e.id]={widgetId:n,isNested:s,isDivContainer:r,adId:e.id,dims:e.dims,definedDims:e.definedDims,creativeId:e.el.getAttribute("data-creative-id"),rt:e.el.getAttribute("data-response-token"),adStatus:D.adStatus.processed,displayStatus:D.displayStatus.displayed,viewabilityStatus:t.viewabilityStatus||D.viewabilityStatus.notViewed,visibilityStatus:D.visibilityStatus.notVisible,viewability:E.getNewViewability(),visibility:E.getNewViewability()},s&&E.supportsIntersectionObserver()){var i=e.id;g("visibility",i,0,1,function(){G.sendVisibilityImpressions()}),g("viewability",i,.5,1e3,function(){G.sendViewableImpressions()})}});var a=P.getElementsByClassName("adn-external-container");if(C.util.forEach(a,function(i){var e=i.parentNode;e&&e.className&&!(e.className.indexOf(D.cwClass)<0)&&i.href&&C.util.addEventListener(e,"click",function(e){for(var t=e.target;t&&"a"!==t.nodeName.toLowerCase();)t=t.parentNode;t&&!E.getEnvFromHref(t.href)&&G.sendClick(i.href)})}),C.util.forEach(c,function(e){e()}),c=[],!E.isWidgetId(n))return C.out.devOutput("Couldn't derive a widget ID","processAd",n,e,t);E.postMessageToParent({messageType:D.postMessageType.toParentImpression,method:C.inIframe.isResizeToContent()?"styleFromAds":"triggerViewabilityReading",retAdCount:t,retAdsW:i.contentDims.w,retAdsH:i.contentDims.h,dims:{w:i.contentDims.w,h:i.contentDims.h},ads:E.generateAdData(null,i,x),widgetId:n,isDivContainer:r})}(t,i,e.matchedAdCount)},callParentFunction:function(e,t){if(!C.util.isStringWithChars(e))return C.out.output("Missing the necessary args in "+e,"callParentFunction");E.postMessageToParent({messageType:D.postMessageType.toParentFunctions,widgetId:C.inIframe.getIframeId(),name:e,args:t})},getIframeArgs:function(){return E.combineArgs(E.parseUrlArgs(),E.parseHashArgs())},getIframeId:function(e){if(e&&0===e.indexOf(D.widgetIdPrefix))return e;var t=P.getElementsByTagName("body")[0].id;if(t&&0===t.indexOf(D.widgetIdPrefix))return t;var i=C.inIframe.getIframeArgs().ifrId;if(C.util.isStringWithChars(i)&&i!==D.previewId)return i;var n="";i===D.previewId&&(n=D.previewId);var r=C.util.getFrameElement();return C.util.isDefined(r)?r.id:n},parentSubscribeEvent:function(e){if(!(C.util.isObject(e)&&C.util.isString(e.event)&&C.util.isString(e.ifrId)&&C.util.isFunction(e.cb)))return C.out.output("Need better args","parentSubscribeEvent",e);E.postMessageToParent({messageType:D.postMessageType.toParentSubscribe,event:e.event,widgetId:e.ifrId}),t[e.event]=t[e.event]||[],t[e.event].push({widgetId:e.ifrId,cb:e.cb})},updateAd:function(t){if(!t||!t.ifrId)return C.out.output("Need arguments and an iframe id","inIframe",t);var e=E.getAdsInfo(t.ifrId),i=t.method||"updateIframe",n=t.targetStyle||t.parentStyle,r={messageType:D.postMessageType.toParentUpdateAd,method:i,w:t.ifrW||"",h:t.ifrH||"",ads:E.generateAdData(null,e,x),params:C.util.isObject(t.params)?t.params:"",ifrStyle:C.util.isObject(t.ifrStyle)?t.ifrStyle:"",targetStyle:C.util.isObject(n)?n:"",widgetId:t.ifrId,stack:t.stack||"static"};t.el&&t.event?C.util.addEventListener(t.el,t.event,C.util.createDelegate(C.util,function(e){if(E.postMessageToParent(r),t.cb){if(!C.util.isFunction(t.cb))return C.out.output("Callback supplied not a function","inIframe");t.cb(e,t)}})):E.postMessageToParent(r)}}}(),function(){function s(t){var f=C.lib.getRequestLocs(t,!0);if(b=[],r=[],0===R.length){var e=P.querySelector("meta[name='keywords']");e&&e.content&&(R=C.util.uniques(C.util.map(e.content.split(","),function(e){return C.util.trim(e)})).slice(0,100))}function i(e,t,i,n){var r=C.util.isObject(i)?E.clone(i):{},s=Math.random(),a=t.keywords||r.keywords||[];C.util.isString(a)&&(a=[a]);var o=0<a.length?C.util.uniques(R.concat(a)):R,u=P.querySelector("link[rel='canonical']"),d=u?u.href||u.getAttribute("href"):void 0,l={auId:t.auId||t.targetId||t.widgetId,requestArgs:n,parentArgs:i,auArgs:t,mode:r.mode||t.mode,format:"script"===t.format?"script":void 0,creativeId:t.creativeId,creativeData:t.creativeData,creativeContent:t.creativeContent,requestMode:D.requestMode[r.requestMode||t.requestMode]||D.requestMode.DEFAULT,networkId:t.networkId||r.networkId,widgetId:t.widgetId||D.widgetIdPrefix+s,auW:t.auW||t.creativeWidth||0,auH:t.auH||t.creativeHeight||0,display:t.display||void 0,c:t.c||r.c||void 0,gdpr:t.gdpr||r.gdpr||void 0,consentString:t.consentString||r.consentString||void 0,ctx:t.ctx||r.ctx||T.location.href,canonical:t.canonical||r.canonical||d,kv:t.kv||r.kv||void 0,keywords:0<o.length?o:void 0,auml:t.auml||void 0,replacements:t.replacements||r.replacements,segments:t.segments||r.segments,userSegments:r.userSegments||t.userSegments,ps:C.util.isNumber(t.ps)?t.ps:void 0,adStatus:D.adStatus.init,displayStatus:D.displayStatus.notDisplayed,container:D.container[t.container||r.container||"nothing"]||D.container.iframe,env:t.env||r.env||D.env.production.id,dn:t.dn||r.dn||!1,viewabilityStatus:D.viewabilityStatus.notViewed,visibilityStatus:D.visibilityStatus.notVisible,impRequestLoc:f.imp,floorPrice:t.floorPrice||r.floorPrice||void 0,protocol:t.protocol||r.protocol||void 0,renderedImpRequestLoc:f.rendered,viewImpRequestLoc:f.viewable,visImpRequestLoc:f.visible,customRequestLoc:f.custom,previewLoc:f.preview,headerBids:t.headerBids||r.headerBids,functionCalls:t.functionCalls||r.functionCalls,functions:t.functions||r.functions,requestParams:E.assign(r.requestParams||{},t.requestParams||{}),collapsible:!1!==t.collapsible,method:r.method||t.method,devScript:t.devScript||!1,excludedCreatives:r.excludedCreatives||[],excludedLineItems:r.excludedLineItems||[],onError:t.onError||r.onError||C.util.noop,onVisible:t.onVisible||r.onVisible||C.util.noop,onViewable:t.onViewable||r.onViewable||C.util.noop,onNoMatchedAds:t.onNoMatchedAds||r.onNoMatchedAds,onImpressionResponse:t.onImpressionResponse||r.onImpressionResponse,onPageLoad:t.onPageLoad||r.onPageLoad,onRestyle:t.onRestyle||r.onRestyle,siteId:t.siteId||r.siteId,usi:t.usi||r.usi,userId:t.userId||r.userId,useCookies:!(!1===t.useCookies||!1===r.useCookies),sessionId:t.sessionId||r.sessionId,latitude:t.latitude||r.latitude,longitude:t.longitude||r.longitude,clearTarget:C.util.isDefined(t.clearTarget)?t.clearTarget:C.util.isTrue(r.clearTarget),targetClass:r.targetClass||t.targetClass,targetId:t.targetId||"adn-"+(t.auId||t.creativeId)+(r.targetClass||t.targetClass?s:""),isolateFrame:C.util.isDefined(t.isolateFrame)?t.isolateFrame:r.isolateFrame||!1,isolateSubFrame:C.util.isDefined(t.isolateSubFrame)?t.isolateSubFrame:r.isolateSubFrame||!1,serverUrl:f.imp+"&auId="+t.auId,resizeOnPageLoad:C.util.isDefined(t.resizeOnPageLoad)?t.resizeOnPageLoad:r.resizeOnPageLoad,viewability:E.getNewViewability()};if(l.cachedFunctionCalls=l.cachedFunctionCalls||[],C.util.isNumber(t.refresh)&&(l.refresh={delay:parseInt(t.refresh,10),event:"onViewable",count:1}),C.util.isObject(t.refresh)&&C.util.isNumber(t.refresh.delay)&&(l.refresh={delay:parseInt(t.refresh.delay,10),event:"onVisible"===t.refresh.event?t.refresh.event:"onViewable",count:C.util.isNumber(t.refresh.count)&&0<C.util.isNumber(t.refresh.count)?parseInt(t.refresh.count):1}),l.devScript&&(l.serverUrl+="&isDevScript=true"),e.push(l),!l.targetClass){var c=C.util.filter(O,function(e){return e.targetId===l.targetId});l.duplicateId=0<c.length}var g=E.getDocEl(l);l.prevStyle=g?g.getAttribute("style"):"",O[l.widgetId]=l}var n=E.assign({},t);delete n.adUnits,delete n.creatives,C.util.isArray(t.adUnits)&&!t.isPreview?C.util.forEach(C.util.isArray(t.adUnits)?t.adUnits:[],function(e){i(b,e,n,t)}):C.util.isArray(t.creatives)?C.util.forEach(C.util.isArray(t.creatives)?t.creatives:[],function(e){i(r,e,n,t)}):C.util.isStringWithChars(t.creativeContent)?i(r,t,void 0,t):i(b,t,void 0,t)}var b,r;function a(t,e){var i=E.getDocEl(t);if(!i)return C.out.output("Couldn't find target element","Creative preview",t,i,t.onError);var n=C.util.find(i.childNodes,function(e){return e.id===t.widgetId});if(0<e.indexOf("adnOptionContainerDiv")&&(t.container=D.container.div),0<e.indexOf("adnOptionContainerIframe")&&(t.container=D.container.iframe),!n)if(t.container===D.container.div)J.showTargetDiv(i,t),i.innerHTML=E.getAdContentOnly(e,t.widgetId),C.util.loadScriptElements(i,t.widgetId);else{t.serverUrl=null;var r=J.insIframe(t,i),s=r.contentDocument||r.contentWindow.document;s.open(),s.write(e),s.close()}}w={ifr:function(){var e=b[0];return e&&e.auId?e.requestMode!==D.requestMode.hasTarget||E.getDocEl(e)?void J.insIframe(e):(C.out.devOutput("Skipping ad request","ifr",e),C.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):C.out.output("No auId was found.","ifr")},previewDirect:function(){C.util.forEach(r,function(e){O[e.widgetId].preview=!0,a(e,e.creativeContent)})},preview:function(e){var t=e&&e.widgetId?[e]:r;if(t.length<1)return C.out.output("No creatives to make request for","preview");var s=t[0].previewLoc,i=C.util.filter(t,function(e){return!O[e.widgetId].preview||e.firstPreviewFailed&&!e.secondPreviewAttempted});C.util.forEach(i,function(e){O[e.widgetId].preview=!0,e.secondPreviewAttempted=!!e.firstPreviewFailed}),C.util.forEach(i,function(t){if(!C.util.isString(t.networkId)||!C.util.isString(t.creativeId)&&!C.util.isObject(t.creativeData))return C.out.output("Insufficient creative information for preview","preview",t,t.onError);var e="POST",i=s+"context="+t.networkId;C.util.isString(t.creativeId)&&(e="GET",i+="&creativeId="+t.creativeId,t.secondPreviewAttempted&&(i="https://api.adnuntius.com/api/v1/creativepreview/"+t.creativeId+"?context="+t.networkId));var n,r=C.util.getNewAjax(e,i,function(){if(r.readyState&&4!==r.readyState)return!1;if(r.status&&200!==r.status){if(t.secondPreviewAttempted)return C.out.output("Error status returned","composed",r,t.onError);t.firstPreviewFailed||(t.firstPreviewFailed=!0,w.preview(t))}else{var e;try{e=t.secondPreviewAttempted?JSON.parse(r.responseText):r.responseText}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",t.onError)}a(t,e.html||e)}});C.util.isObject(t.creativeData)&&(n=JSON.stringify(t.creativeData)),r.send(n)})},composed:function(e,t){var i=C.util.isArray(E.getParam(t,"adUnits"))?t.adUnits:b;if(i.length<1)return C.out.output("No ad units to make request for","composed");var n=C.util.isArray(e)?e:b;G.takeProximity();var r=i[0],s=r.impRequestLoc,a=r.headerBids,o=[],u=E.getParam(t,"requestId"),d=0,l=E.gatherDataParams(n,function(e){var t=O[e.widgetId],i=E.getParam(t.requestParams,"load")!==D.loadEnums.lazyRequest||t.withinBounds;return i?i&&e.requestMode===D.requestMode.hasTarget&&!E.getDocEl(e)?(C.out.devOutput("Skipping ad request","composed",e),C.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):i&&50<=d?(o.push(e),!1):(d++,i):(o.push(e),!1)},function(e){O[e.widgetId].composed=!0}),c=l.adUnits,g=l.params;if(0<c.length){s+=E.encodeAsUrlParams(H.getIdsAsObj(r),!0),s+=E.encodeAsUrlParams(H.getAllIdsAsObj()||{},!0),s+=E.encodeAsUrlParams(H.getEuConsentAsObj(r)||{},!0),r.gdpr&&(s+=E.encodeAsUrlParams({gdpr:r.gdpr},!0)),u=u||"request-"+Math.random();var f=U.inScreen===D.feedback.inScreen.inAdUnit||I?"format=json":"tt=multi",p=Date.now(),m=C.util.getNewAjax(E.isTestAddress(s)?"GET":"POST",s+"&"+f,function(){if(m.readyState&&4!==m.readyState)return!1;if(m.status&&200!==m.status)return E.ampCheck(r,{width:0,height:0}),C.out.output("Error status returned","composed",m,r.onError);var e;q=D.composedRequest.requestReturned;try{e=JSON.parse(m.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",r.onError)}return e.adUnits?(e.metaData&&H.writeAdvLs(e.metaData),C.util.forEach(e.adUnits,function(e){k[e.targetId]=e}),L[u]={requestId:u,duplicateFilter:E.getParam(e,"duplicateFilter")},S=Date.now()-p,void J.distributeComposedAds(e)):C.out.output("No ad units defined in returned data","composed",r.onError)});m.withCredentials=!E.isTestAddress(s);var v=E.gatherExclusions(i);v.adUnits=c,E.setAndReturnMetaData(v),C.util.isArray(a)&&(v.headerBids=a);var h=E.getParam(L[u],"duplicateFilter");h&&(v.duplicateFilter=h);var y=H.getConsent();0<y.length&&(v.consent=y),v=E.combineArgs(v,g),m.send(JSON.stringify(v)),q=D.composedRequest.requestMade}0<o.length&&T.setTimeout(function(){w.composed(o,{requestId:u,adUnits:i})},153)}};var t={style:function(t){e(function(e){E.applyStyle(e,t.style)})},resize:function(t){e(function(e){C.util.isDefined(t.width)&&(e.style.width=C.util.dimension(t.width)),C.util.isDefined(t.height)&&(e.style.height=C.util.dimension(t.height))})}};function e(e){var t,i,n=C.util.getFrameElement()||(t=b[0],(i=E.getDocEl(t))?i.firstChild:(C.out.warn("Unable to find HTML element on page with the following id: "+t.targetId),C.out.output("No target element was found.","getWidgetEl")));n&&e(n)}function o(e,t,i){var n=e.method||i;return t[n]?t[n].call(this,e):C.out.output("Matching method not found for "+n,"init")}C.clearLocalStorage=function(){H.clearAdvLocalStorage()},C.useLocalStorage=function(e){h=!1!==e},C.useCookies=function(e){y=!1!==e},C.consent=function(e){var t=C.util.isArray(e)?{consent:e}:e;if(!t.consent||!C.util.isString(t.consent)&&!C.util.isArray(t.consent))return C.out.output("Not a valid network id or array object","adn.regConsent",e);H.writeConsent(C.util.isArray(t.consent)?t.consent:[t.consent])},C.regTargets=function(i){if(!C.util.isString(i.network)||!C.util.isArray(i.keyValues))return C.out.output("Not a valid network id or array object","adn.regTarget",i);var n=[];if(C.util.forEach(i.keyValues,function(e){if(C.util.isString(e.key)&&C.util.isString(e.value)){var t={key:e.key,value:e.value};e.expiry&&C.util.isInteger(e.expiry)&&(t.expiry=e.expiry),n.push(t)}else C.out.output("Missing an appropriate key and value for registering a target","adn.regTarget",e,i)}),n.length<1)return C.out.output("Missing appropriate targets to register","adn.regTarget",i);var e=C.lib.getRequestLocs(i).retargeting;if(!e)return C.out.output("Couldn't generate req url","regTargets",e,i);var t=C.util.getNewAjax("POST",e,function(){if(t.readyState&&4!==t.readyState)return!1;if(!t.status||200===t.status)return!0;var e=Math.floor(t.status/100);return 4===e?C.out.output("400 error","ajax.onreadystatechange in regTargets",t):5===e?C.out.output("500 error","ajax.onreadystatechange in regTargets",t):C.out.output("Misc error","ajax.onreadystatechange in regTargets",t)});t.open("POST",e),t.withCredentials=!E.isTestAddress(e),t.send(JSON.stringify({network:i.network,keyValues:n}))},C.renderComposedAds=function(){function e(){return C.util.filter(k,function(e){return e.errorStatus===D.errorStatus.noTarget})}if(q!==D.composedRequest.requestReturned)return-1;var t=e();return t.length<1?0:(J.distributeComposedAds(t),e().length)},C.requestData=function(e){if(!C.util.isDefined(e.auId)&&!C.util.isArray(e.adUnits))return C.out.output("Need an ad unit id or adUnits to make this work.","adn.requestData",e);var n=E.assign({},e);if(!C.util.isFunction(n.onSuccess)&&!C.util.isFunction(n.onResponse))return C.out.output("Need a callback function to make the call worthwhile","adn.requestData",n,e);n.onSuccess=C.util.isFunction(n.onSuccess)?n.onSuccess:C.util.noop,n.onError=C.util.isFunction(n.onError)?n.onError:C.util.noop,n.onResponse=C.util.isFunction(n.onResponse)?n.onResponse:C.util.noop;var t,i,r,s=C.lib.getRequestLocs(n,!0).imp;if(r=n.auId&&!C.util.isArray(n.adUnits)?(i=E.gatherDataParams([n],null,null,e).adUnits,n):(i=E.gatherDataParams(n.adUnits).adUnits)[0],!(t=E.encodeUrlParams(s,{format:"json"},e)))return C.out.output("Couldn't generate server url","requestData",t,e);t+=E.encodeAsUrlParams(H.getIdsAsObj(r),!0),t+=E.encodeAsUrlParams(H.getAllIdsAsObj()||{},!0),t+=E.encodeAsUrlParams(H.getEuConsentAsObj(e)||{},!0),e.gdpr&&(t+=E.encodeAsUrlParams({gdpr:e.gdpr},!0));var a=C.util.getNewAjax("POST",t,function(){if(a.readyState&&4!==a.readyState)return!1;function t(e,t){var i=E.assign(e,{responseCode:a.status,responseText:a.responseText});n.onResponse(i),(t||n.onError)(i)}if(!a.status||200===a.status)try{var e=JSON.parse(a.responseText);return t({responseJSON:e},n.onSuccess),e.metaData&&H.writeAdvLs(e.metaData),e}catch(e){return t({error:e,errorText:"Error with parsing the response text"}),C.out.output("Parsing response text fail","ajax.onreadystatechange: catch block",e)}var i=Math.floor(a.status/100);return 4===i?(t({errorText:"Likely error in request made"}),C.out.output("400 error","ajax.onreadystatechange",a)):5===i?(t({errorText:"Likely error in service"}),C.out.output("500 error","ajax.onreadystatechange",a)):(t({errorText:"Error"}),C.out.output("Misc error","ajax.onreadystatechange",a))}),o=E.gatherExclusions(n);E.setAndReturnMetaData(o),o.adUnits=i;var u=H.getConsent();0<u.length&&(o.consent=u),a.send(JSON.stringify(o))},C.regConversion=function(e){if(!C.util.isStringWithChars(e.eventType))return C.out.output("Missing a value for eventType","regConversion",e);if(e.eventValue&&!C.util.isNumber(e.eventValue))return C.out.output("The event value must be a number","regConversion",e);var t=C.lib.getRequestLocs(e).conversion,i=C.util.getNewAjax(E.isTestAddress(t)?"GET":"POST",t,function(){if(i.readyState&&4!==i.readyState)return!1;if(i.status&&200!==i.status)return C.out.output("Error status returned","composed",i);var e;try{e=JSON.parse(i.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",i)}e.metaData&&H.writeAdvLs(e.metaData)});i.withCredentials=!0;var n=E.copyArgValues({},e,["network","adSource","eventType","eventValue"]);E.setAndReturnMetaData(n),i.send(JSON.stringify(n))},C.clearDivs=function(){C.util.forEach(O,function(e){var t=E.getDocEl(e);t&&(C.util.isStringWithChars(e.prevStyle)?t.setAttribute("style",e.prevStyle):t.style.display="none",t.innerHTML="")}),C.clearOut()},C.clearOut=function(){O={},A={},x={},k={},M={},L={},R=[]};var u,d,l,c,i=(u=[],d=2e3,l=4e3,c=function(e){if(!C.util.isArray(e))return!1;var t=!0;return C.util.forEach(e,function(e){C.util.isArray(e)&&2===e.length&&C.util.isInteger(e[0])&&C.util.isInteger(e[1])||(t=!1)}),t},function(e,t,i){n(e,t,i)});function g(t){return C.util.find(u,function(e){return e.reqId===t})}function f(r,s,n,e,a){if(g(e)){var t;t=e,u=C.util.filter(u,function(e){return e.reqId!==t});var i=function(){!a&&C.util.isTrue(E.getParam(n,"gptAsync"))&&r.setTargetingForGPTAsync&&r.setTargetingForGPTAsync();var e=C.util.isFunction(r.getBidResponses)?r.getBidResponses():[],t=C.util.isFunction(r.getNoBids)?r.getNoBids():[],i=C.util.isTrue(E.getParam(n,"debug"));i&&(a&&C.out.output("Prebid.js load timed-out","headerBidRequest"),C.out.simple("Bid responses from prebid",e),C.out.simple("Responses with no bids",t)),s.headerBids=[],C.util.forEach(e,function(e){C.util.forEach(e.bids,function(e){var t=E.clone(e);t.dealId||delete t.dealId,s.headerBids.push(t)})}),C.util.forEach(t,function(e){C.util.forEach(e.bids,function(e){var t=E.clone(e);t.cpm=0,t.statusMessage="Bid returned empty or error response";var i=e.bidderCode||e.bidder;t.bidderCode=C.util.isStringWithChars(i)?i:"",C.util.isStringWithChars(i)||C.out.output("Invalid bidder code has been set. Needs to be a String.","headerBidRequest",e.bidderCode||e.bidder,e);var n=c(e.sizes);n||C.out.output("Invalid sizes have been configured. Should be an two-dimension array of integers within an array","headerBidRequest",e.sizes,e),t.sizes=n?e.sizes:[],t.dealId||delete t.dealId,s.headerBids.push(t)})}),s.adUnits&&C.util.isArray(s.adUnits)&&0!==s.adUnits.length?(i&&C.out.output("Header bids sent through to Adnuntius","headerBidRequest",s.headerBids),C.request(s)):C.util.forEach(r.getHighestCpmBids(),function(e){if(e.adId&&e.adUnitCode){var t=P.createElement("iframe"),i=P.getElementById(e.adUnitCode);if(i){i.append(t);var n=t.contentDocument||t.contentWindow.document;n.open(),r.renderAd(n,e.adId),n.close()}else C.out.output("Could not find target div for "+e.adUnitCode,"Prebid",e)}else C.out.output("Could not find required adId or adUnitCode in bid","Prebid loop",e)})};a||!r.que?i():r.que.push(i)}}function p(){if(0<u.length){var e=u[0];n(e.prebidAdUnits,e.adnRequest,e.config,e.reqId)}}function n(e,t,i,n){var r=t||{},s=n||E.uuid();if(g(s)||u.push({reqId:s,prebidAdUnits:e,adnRequest:r,config:i}),!e||!C.util.isArray(e)||e.length<1)return f({},r,i,s),void p();if(!(1<u.length)||C.util.isString(n)){T.pbjs=T.pbjs||{};var a=T.pbjs;a.que=a.que||[];var o;o=T.setTimeout(function(){f(a,r,i,s,!0),p()},l),a.que.push(function(){o&&T.clearTimeout(o),g(s)?(a.removeAdUnit(),i&&a.setConfig(i),a.addAdUnits(e),a.requestBids({bidsBackHandler:function(){f(a,r,i,s),p()},timeout:d})):C.out.output("Prebid script loading probably timed out and only now has prebid loaded, which is after the ad request has passed through to Adnuntius","headerBid",u)})}}function m(){var e=H.getAllDatStorageAsObj();return e.browserId=C.util.isStringWithChars(e.browserId)?e.browserId:E.uuid(),e.sessionId=C.util.isStringWithChars(e.sessionId)?e.sessionId:E.uuid(),e.extSync=C.util.isObject(e.extSync)?e.extSync:{},H.writeDatLs(e),e}function v(e,t,i,n){if(!C.util.isStringWithChars(e))return C.out.output("Need a folder Id","adnDataRequest",e,t,i);var r=E.clone(t||{});r.folderId=e;var s=m();r.browserId=r.browserId||s.browserId,r.sessionId=s.sessionId,r.ctx=T.location.href;var a,o=C.lib.getAdnDataLocs(r),u=o[i.locKey];if(u+=E.encodeAsUrlParams(H.getEuConsentAsObj(r)||{},!0),u+=E.encodeAsUrlParams(H.getAdnConsentAsObj()||{},!0),i.pick&&i.pick.length){var d=E.copyArgValues({},r,i.pick)||{};"POST"===i.method?a=JSON.stringify(d):u+=E.encodeAsUrlParams(d,!0)}var l=C.util.getNewAjax(i.method,u,C.util.isFunction(n)?function(){n(l)}:null);l.withCredentials=!E.isTestAddress(o[i.locKey]),l.send(a)}C.getSegments=function(e,i){var t=H.getDatSegments();t.segments?i&&C.util.isFunction(i.onResponse)&&i.onResponse(t):v(e,i,{method:"GET",pick:["uui"],locKey:"user"},function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&C.util.isStringWithChars(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){C.out.output(e,"ajax.onreadystatechange: catch block send event",t)}delete(e=C.util.isObject(e)?e:{}).expiryEpochMillis,H.writeDatSegments(e),i&&C.util.isFunction(i.onResponse)&&i.onResponse(e)}})},C.getGlobalId=function(e,i){v(e,i,{method:"GET",locKey:"id"},function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&C.util.isStringWithChars(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){C.out.output(e,"ajax.onreadystatechange: catch block send event",t)}e=C.util.isObject(e)?e:{},C.util.isFunction(i.onResponse)&&i.onResponse(e)}})},C.getBrowserId=function(){return m().browserId},C.visitor=function(e,t){v(e,t,{method:"POST",pick:["profileValues","browserId","sessionId","folderId"],locKey:"visitor"})},C.view=function(e,t){v(e,t,{method:"POST",pick:["categories","keywords","domainName","ctx"],locKey:"page"})},C.assignSegment=function(e,t){v(e,{segmentId:t},{method:"GET",pick:["segmentId"],locKey:"segment"})},C.externalUserSync=function(e,t){if(!C.util.isStringWithChars(e)||!D.sync[t])return C.out.output("Need a valid folder ID and external system ID to proceed","externalUserSync",e,t);var i=m(),n=D.sync[t].replace("{BROWSER_ID}",encodeURIComponent(i.browserId)).replace("{FOLDER_ID}",encodeURIComponent(e)),r=i.extSync[t];(new Date).getTime();C.util.isInteger(r);var s=P.createElement("img");s.setAttribute("alt",""),s.setAttribute("src",n),s.setAttribute("class","adn-sync-pixel"),s.setAttribute("height","1px"),s.setAttribute("width","1px"),P.body.appendChild(s)},C.sync=function(e,t){if(!C.util.isStringWithChars(t.externalSystemType)||!C.util.isStringWithChars(t.externalSystemUserId))return C.out.output("Need an external system type or external system user id","sync",e,t);v(e,t,{method:"POST",pick:["externalSystemType","externalSystemUserId","browserId"],locKey:"sync"})},C.chbRequest=i,C.regScriptServe=function(e,t){var i=P.getElementById("script-"+t);return i&&i.src&&-1<i.src.indexOf("format=js")?(s({widgetId:t,container:"div"}),E.addWidgetIdToProcessAd(e,t)):e},C.callChildFunction=function(n){if(!n||!C.util.isStringWithChars(n.name))return C.out.output("Not enough info to proceed","callChildFunction",name);var r={name:n.name,args:n.args,event:D.events.CUSTOM},s={messageType:D.postMessageType.toChildPubs,event:D.events.CUSTOM,functionCalls:[r]};C.util.forEach(O,function(e,t){if(!(C.util.isStringWithChars(n.targetId)&&e.targetId!==n.targetId||C.util.isStringWithChars(n.targetClass)&&e.targetClass!==n.targetClass||C.util.isStringWithChars(n.auId)&&e.auId!==n.auId)){s.widgetId=e.widgetId;var i=P.getElementById(e.widgetId);if(!i)return O[t].cachedFunctionCalls=O[t].cachedFunctionCalls||[],void O[t].cachedFunctionCalls.push(r);E.postMessageToChild(i,s)}})},C.request=function(r){function e(){var i=r;if(r.amp&&r.amp.data){(i=r.amp.data).mode="amp",i.container=i.container||"div",i.adUnits=[{auId:i.auId,auW:i.width,auH:i.height}],C.util.forEach(["c","kv","segments","floorPrice"],function(t){if(C.util.isString(i[t]))try{i[t]=JSON.parse(i[t])}catch(e){i[t]=""}else i[t]=""});var e=i.targetId||"adn-"+i.auId;if(!P.getElementById(e)){var t=P.createElement("div");t.setAttribute("id",e),P.getElementById("c").appendChild(t)}}s(i);var n=D.methodEnums.ifr;C.util.isArray(i.adUnits)&&!r.isPreview?n=D.methodEnums.composed:C.util.isArray(i.creatives)?n=D.methodEnums.preview:C.util.isStringWithChars(i.creativeContent)&&(n=D.methodEnums.previewDirect),o(i,w,n)}r.requestTiming===D.requestTiming.onReady?E.onDocReady(e):r.requestTiming===D.requestTiming.onLoad?E.onLoad(e):e()},C.display=function(e){o(e,t,"style")},C.setFeedbackOptions=function(e){B.setFeedbackOptions(e)},C.preview=function(e){return C.util.isArray(e.creatives)?C.util.isStringWithChars(e.networkId)?(e.isPreview=!0,void C.request(e)):C.out.output("A network ID is required for a preview","preview",e):C.out.output("An array of creatives is required for preview","preview",e)}}(),function(){if(!n){var e=E.getScriptOverride();if(e){var t=P.createElement("script");return t.type="text/javascript",t.id=c,t.src=e,P.body.appendChild(t)}}V(),B.registerListeners(),B.setFeedbackOptions();function i(){try{for(var t;t=C.calls.shift();)try{t()}catch(e){C.out.output(e,"executeCalls: inside while catch block",t,C.calls)}}catch(e){C.out.output(e,"executeCalls: outside while catch block",C.calls)}}T.setTimeout(i,25),C.calls.push=function(){return Array.prototype.push.apply(this,arguments),T.setTimeout(i,1),this.length}}()}(adn,document,window)}catch(e){adn.out.output(e,"Blanket catch block")}
//# sourceMappingURL=adn.js.map
